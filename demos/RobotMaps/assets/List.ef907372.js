import{_ as E,a as M,v as N}from"./index.101c31c3.js";import{C as $}from"./CMap.d100e5df.js";import{v as F,u as I,D as T,a as U,p as b,J as V,h as q,g as z,C as S,j as L,o as d,b as v,k as W,i as _,F as H,q as J,n as h,s as A,m as g,z as G,t as p}from"./vendor.dfe6942c.js";const K={components:{CMap:$},setup(){const{t:s}=F(),l=I(),k=T(),t=U(),f=b(null),u={},w=V({}),o=b(null),n=b(null);l.getters.maps.then(e=>e&&(o.value=e)),q(()=>{window.addEventListener("scroll",C,!1)}),z(()=>{window.removeEventListener("scroll",C,!1)}),S(o,C);function i(e){const a=o.value[e];u[e].setMap(M.join(a.image_path,{t:l.state.t}))}let r=null;function C(){if(clearTimeout(r),!f.value)return!1;r=setTimeout(()=>{if(!f.value)return!1;[].slice.call(f.value.children).forEach((a,m)=>{const c=a.getBoundingClientRect();w[m]=!(c.top+c.height<48+c.height/3||c.top>window.innerHeight-c.height/3)})},300)}S(n,(e,a)=>{u[a]&&u[a].stop(),u[e]&&u[e].play()});function B(e){N(),window.modal({title:s("top.Warn"),content:s("top.WDTM"),success:({confirm:a})=>{if(!a)return;const m=o.value[e],c=window.loading(s("top.DeMa"));M.map.del({sn:l.state.sn,map_uuid:m.uuid}).then(()=>{o.value.splice(e,1)}).catch(D=>alert(D.message)).finally(()=>c.remove())}})}function R(e){const a=o.value[e];return window.sessionStorage.setItem("selectedMapUuid",a.uuid),y()}function j(e){const a=o.value[e],m=window.loading(s("top.MaSw"));M.map.change({sn:l.state.sn,map_uuid:a.uuid}).then(()=>(m.set(s("top.SSwR")),M.query(!0))).then(()=>{window.sessionStorage.setItem("selectedMapUuid",""),y()}).catch(c=>alert(c.message)).finally(()=>m.remove())}function y(){return k.params.from?t.replace(k.params.from):t.back()}return{box:f,mapRefs:u,mapShow:w,mapMounted:i,mapList:o,active:n,delMap:B,editMap:R,switchMap:j}}},O={class:"list",ref:"box"},P=["onClick"],Q={key:1,class:"current"},X={class:"name"},Y={class:"floor"},Z={class:"btns"},x=["onClick"],ee=["onClick"],te=["onClick"];function se(s,l,k,t,f,u){const w=L("Navbar"),o=L("CMap");return d(),v("div",{class:"v-map-list",onClick:l[0]||(l[0]=n=>t.active=null)},[W(w,{class:"navbar",title:s.$t("map.MaLi"),light:""},null,8,["title"]),_("div",O,[t.mapList?(d(!0),v(H,{key:0},J(t.mapList,(n,i)=>(d(),v("div",{class:A(["item",{active:t.active===i}]),key:n.uuid,onClick:g(r=>t.active=i,["stop"])},[t.mapShow[i]?(d(),G(o,{key:0,onMounted:r=>t.mapMounted(i),ref:r=>t.mapRefs[i]=r},null,8,["onMounted"])):h("",!0),n.is_current?(d(),v("div",Q,p(s.$t("map.Curr")),1)):h("",!0),_("div",X,p(n.name),1),_("div",Y,p(s.$t("map.Floo"))+": "+p(n.floor),1),_("div",Z,[n.is_current?h("",!0):(d(),v("div",{key:0,class:"btn del",onClick:g(r=>t.delMap(i),["stop"])},p(s.$t("btn.Dele")),9,x)),_("div",{class:"btn edit",onClick:g(r=>t.editMap(i),["stop"])},p(s.$t("btn.Edit")),9,ee),n.is_current?h("",!0):(d(),v("div",{key:1,class:"btn switch",onClick:g(r=>t.switchMap(i),["stop"])},p(s.$t("btn.Swit")),9,te))])],10,P))),128)):h("",!0)],512)])}var ie=E(K,[["render",se]]);export{ie as default};
