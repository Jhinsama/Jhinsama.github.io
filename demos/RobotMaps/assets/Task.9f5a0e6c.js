import{_ as ue,a as p}from"./index.632b0bf4.js";import{C as de,a as ce,D as ve}from"./CMap.3cedf296.js";import{P as me}from"./Picker.f2fec7b4.js";import{v as pe,u as fe,p as w,x as U,C as O,j as B,N as ge,o as f,b as g,k as z,s as N,i as s,F as L,q as H,t as d,n as x,w as he,E as V,G as be,m as A,I as we,O as _e}from"./vendor.dfe6942c.js";const ye={components:{CMap:de,Picker:me},setup(){const{t:l}=pe(),a=fe(),u=w(null),t=w(null),E=w(null),_=w(""),c=w({}),P=U(()=>a.state.robot.status||{}),C=w(null),R=w({}),o=U(()=>C.value?C.value.map(e=>e.name):[]),v=w(null),b=w(null),J=U(()=>Boolean(c.value.list&&c.value.list.length));a.getters.maps.then(e=>{!e||(C.value=e,e.forEach(n=>R.value[n.uuid]=n.name))});function F(){p.cruise.list({sn:a.state.sn}).then(e=>{b.value=e.cruise_list}).catch(e=>alert(e.message))}F();let S=0;O(_,e=>{!u.value||(e==="RUNNING"?u.value.setEvent({wheel:()=>!(S!==1/0&&(S=new Date().getTime())&&!1),down:n=>!(n.length===1&&(S=1/0)&&!1),up:n=>!(!n.length&&(S=new Date().getTime())&&!1)}):e==="EDITOR"?u.value.setEvent({tap(n){const i=u.value.getMapPoint(n.mx,n.my,!0);if(!i)return null;c.value.list.push({uuid:i.uuid,map_uuid:v.value,name:i.name,x:i.x,y:i.y,stay_time:5}),_e(()=>{t.value&&(t.value.scrollTop=t.value.scrollHeight)})}}):u.value.cleanEvent())}),O([u,v],([e,n])=>{if(!n||!e)return!1;const i=C.value.find(r=>r.uuid===n);e.setMap(p.join(i.image_path,{t:a.state.t})),e.setMapPoints(i.point_list.map(r=>new ce(Object.assign(r,{x:Number(r.x),y:Number(r.y),name:r.name,type:Number(r.type),angle:Number(r.angle)})))),e.setMapWalls(i.wall_list.map(r=>({sx:Number(r.start_x),sy:Number(r.start_y),ex:Number(r.end_x),ey:Number(r.end_y)})))}),O(()=>a.state.robot,e=>{!u.value||(!e.status||!e.position||e.status.map_uuid!==v.value?(u.value.setMapRobot(null),u.value.setMapLine(null),_.value==="RUNNING"&&(v.value=e.status.map_uuid)):(u.value.setMapRobot(new ve({x:Number(e.position.x),y:Number(e.position.y),angle:Number(e.position.angle)})),u.value.setMapLine(e.position.path),_.value==="RUNNING"&&new Date().getTime()-S>3e3&&u.value.moveTo(Number(e.position.x),Number(e.position.y),100)))});let I=null,T=null;function W(){I=window.loading(l("top.MaLo"))}function Y(e){if(!!I){if(I.remove(),I=null,!T||e===!0)return T=null;u.value.moveTo(T.x,T.y,300),T=null}}function K(e){const n=b.value[e]||{};c.value={name:n.name||"",uuid:n.uuid||"",list:n.point_list?JSON.parse(JSON.stringify(n.point_list)):[]},u.value.play();const i=window.innerHeight,r=E.value.offsetHeight;u.value.setOffset(0,Math.round(i/2-r-(i-r-48)/2)),_.value="EDITOR",c.value.list[0]&&(v.value=c.value.list[0].map_uuid)}function D(){u.value.stop(),u.value.setOffset(0,0),_.value=""}function Q(e){e.map_uuid===v.value?u.value.moveTo(e.x,e.y,200):(v.value=e.map_uuid,T=e)}function X(){if(!!c.value){if(!c.value.list.length)return window.toast(l("top.ChWF"));window.prompt(l("top.StTi")).then(e=>{e!==null&&c.value.list.forEach(n=>n.stay_time=e)})}}function Z(e){window.prompt(l("top.StTi")).then(n=>{n!==null&&(e.stay_time=n)})}function $(){D()}function ee(){if(c.value.uuid){const e=window.loading(l("top.DeRo"));p.cruise.del({sn:a.state.sn,cruise_uuid:c.value.uuid}).then(()=>(e.set(l("top.Sync")),F(),D(),p.query(!0))).catch(n=>alert(n.message)).finally(()=>e.remove())}else D()}function te(){const e=c.value;if(!e.name)return window.toast(l("top.TaNa"));e.list.forEach((i,r)=>i.point_index=r);const n=window.loading(l("top.SRDa"));p.cruise.update({sn:a.state.sn,name:e.name,cruise_uuid:e.uuid,point_list:JSON.stringify(e.list)}).then(()=>(n.set(l("top.Sync")),F(),D(),p.query(!0))).catch(i=>alert(i.message)).finally(()=>n.remove())}function ne(e,n){(n?Promise.resolve(n):window.prompt(l("top.ReNu"))).then(i=>{if(!i)return;const r=b.value[e],h=window.loading();p.cruise.start({sn:a.state.sn,cruise_uuid:r.uuid,count:i}).then(()=>(h.set(l("top.RecR")),p.query(!0))).then(()=>{var y;u.value.play(),_.value="RUNNING",((y=r.point_list)==null?void 0:y[0])&&(v.value=r.point_list[0].map_uuid)}).catch(y=>alert(y.message)).finally(()=>h.remove())})}function ae(){const e=window.loading();p.cruise.pause({sn:a.state.sn}).then(()=>(e.set(l("top.SPaR")),p.query(!0))).catch(n=>alert(n.message)).finally(()=>e.remove())}function se(){const e=window.loading();p.cruise.resume({sn:a.state.sn}).then(()=>(e.set(l("top.SReR")),p.query(!0))).catch(n=>alert(n.message)).finally(()=>e.remove())}function oe(){const e=window.loading();p.move.stop({sn:a.state.sn}).then(()=>(e.set(l("top.SStR")),p.query(!0))).then(()=>{u.value.stop(),_.value=""}).catch(n=>alert(n.message)).finally(()=>e.remove())}const k=w(null);let m=null,M=null,G=null;function le(e){for(m=e.target;m!==document.body&&m.getAttribute("dragitem")===null;)m=m.parentNode;m===document.body?m=null:(e.preventDefault(),m=m.parentNode,m.style.cssText="opacity: 0.5",k.value=[].slice.call(m.parentNode.children).findIndex(n=>n===m))}function ie(e){if(!m)return;e.preventDefault();const n=e.target.parentNode,{clientY:i}=e.touches[0],r=t.value,{top:h,height:y}=r.getBoundingClientRect();return i-20<h?j((i-20-h)/10,n,i):i+20>h+y?j((i+20-h-y)/10,n,i):(clearInterval(M),M=null,q(n,i))}function j(e,n,i){G=e>10?10:e<-10?-10:e,!M&&(M=setInterval(()=>{t.value.scrollTop+=G,q(n,i)},30))}function q(e,n){const{top:i,height:r}=e.getBoundingClientRect();let h=[].slice.call(e.parentNode.children).findIndex(y=>y===e);h+=Math.round((n-i)/r),k.value=h<0?0:h>c.value.list.length?c.value.list.length:h}function re(e){if(!!m){if(clearInterval(M),M=null,k.value!==null){const n=[].slice.call(m.parentNode.children).findIndex(r=>r===m),i=c.value.list.splice(n,1)[0];c.value.list.splice(n<k.value?k.value-1:k.value,0,i)}m.style.cssText="",k.value=m=null}}return{map:u,listBox:t,mapImgLoadStart:W,mapImgLoadEnd:Y,editorBox:E,status:_,focusTask:c,robotStatus:P,mapList:C,mapMapName:R,mapNameList:o,activeMapUuid:v,cruiseList:b,disabledPicker:J,editor:K,startCruise:ne,toMapPoint:Q,changeAllStayTime:X,changeStayTime:Z,cancelEditor:$,delTask:ee,saveTask:te,pauseCruise:ae,nextCruise:se,stopCruise:oe,dragIndex:k,onFingerDown:le,onFingerMove:ie,onFingerUp:re}}},Ne={class:"v-map-task"},ke={key:0,class:"main"},Ce=["onClick"],Te={class:"name"},Me=["onClick"],Se=["onClick"],xe={key:0,class:"arrow",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32"},Re=s("path",{d:"M573.056 752l308.8-404.608A76.8 76.8 0 0 0 820.736 224H203.232a76.8 76.8 0 0 0-61.056 123.392L450.976 752a76.8 76.8 0 0 0 122.08 0z"},null,-1),Ie=[Re],De={class:"title"},Le=["placeholder"],Ee={class:"title"},Pe=s("path",{d:"M512 955.733333c-121.890133 0-227.584-43.8784-314.146133-130.440533C111.872 739.293867 68.266667 633.9072 68.266667 512c0-121.873067 43.588267-227.549867 129.536-314.112C284.450133 111.854933 390.144 68.266667 512 68.266667c121.890133 0 227.2768 43.605333 313.2928 129.5872C911.854933 284.416 955.733333 390.109867 955.733333 512c0 121.924267-43.895467 227.328-130.474666 313.326933C739.328 911.837867 633.924267 955.733333 512 955.733333z m0-853.333333c-112.520533 0-210.1248 40.2432-290.065067 119.620267C142.6432 301.8752 102.4 399.4624 102.4 512c0 112.520533 40.226133 209.800533 119.586133 289.160533C301.909333 881.083733 399.496533 921.6 512 921.6c112.4864 0 209.7664-40.4992 289.1264-120.405333C881.1008 721.7664 921.6 624.4864 921.6 512c0-112.503467-40.516267-210.090667-120.439467-290.013867C721.783467 142.626133 624.503467 102.4 512 102.4z m0 768c-98.679467 0-183.995733-35.259733-253.559467-104.840533S153.6 610.679467 153.6 512s35.2768-183.995733 104.840533-253.559467S413.320533 153.6 512 153.6s183.995733 35.2768 253.559467 104.840533C835.140267 328.004267 870.4 413.320533 870.4 512s-35.259733 183.978667-104.840533 253.559467S610.679467 870.4 512 870.4z m0-682.666667c-89.2928 0-166.485333 31.914667-229.4272 94.839467S187.733333 422.7072 187.733333 512s31.914667 166.485333 94.839467 229.4272C345.514667 804.369067 422.7072 836.266667 512 836.266667s166.485333-31.8976 229.4272-94.839467C804.369067 678.485333 836.266667 601.2928 836.266667 512s-31.8976-166.485333-94.839467-229.4272C678.485333 219.648 601.2928 187.733333 512 187.733333z m256 341.333334H341.333333a17.066667 17.066667 0 1 1 0-34.133334h426.666667a17.066667 17.066667 0 1 1 0 34.133334z","p-id":"2735"},null,-1),Fe=s("path",{d:"M384 674.133333a34.133333 34.133333 0 0 1-24.132267-58.2656L477.866667 497.851733V256a34.133333 34.133333 0 0 1 68.266666 0v256a34.013867 34.013867 0 0 1-9.506133 23.6544l-0.017067 0.017067-0.512 0.512-127.9488 127.9488a34.030933 34.030933 0 0 1-24.149333 10.001066z"},null,-1),Ue=[Pe,Fe],Oe=s("th",null,null,-1),Be={colspan:"2"},ze={class:"index",dragitem:""},Ge=["onClick"],je=["onClick"],qe=["onClick"],He=s("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32"},[s("path",{d:"M603.491471 512L1005.058336 110.433134a64.696385 64.696385 0 0 0-91.49147-91.49147L512 420.508529 110.433134 18.941664a64.696385 64.696385 0 0 0-91.49147 91.49147L420.508529 512 18.941664 913.566866a64.696385 64.696385 0 0 0 91.49147 91.49147L512 603.491471l401.566866 401.566865a64.696385 64.696385 0 0 0 91.49147-91.49147z"})],-1),Ve=[He],Ae=s("td",{colspan:"4"},null,-1),Je=[Ae],We={class:"btns"},Ye={key:0,class:"run-tips"};function Ke(l,a,u,t,E,_){const c=B("CMap"),P=B("Navbar"),C=B("Picker"),R=ge("finger");return f(),g("div",Ne,[z(c,{class:"map-box",onMaploadstart:t.mapImgLoadStart,onMapload:t.mapImgLoadEnd,onMaploadfail:a[0]||(a[0]=o=>t.mapImgLoadEnd(!0)),ref:"map"},null,8,["onMaploadstart","onMapload"]),z(P,{class:N(["navbar",{active:!t.status||t.status==="EDITOR"}]),title:t.status?l.$t("map.RoEd"):l.$t("map.PlRo")},null,8,["class","title"]),s("div",{class:N(["task-list-box",{active:!t.status}])},[t.cruiseList?(f(),g("div",ke,[(f(!0),g(L,null,H(t.cruiseList,(o,v)=>(f(),g("div",{class:"item",onClick:b=>t.editor(v),key:o.uuid},[s("div",Te,d(o.name),1),s("div",{class:"btn",onClick:A(b=>t.startCruise(v,1),["stop"])},d(l.$t("map.Sing")),9,Me),s("div",{class:"btn",onClick:A(b=>t.startCruise(v),["stop"])},d(l.$t("map.Recu")),9,Se)],8,Ce))),128)),s("div",{class:"create",onClick:a[1]||(a[1]=o=>t.editor(null))},d(l.$t("map.NeRo")),1)])):x("",!0)],2),(f(),g(L,{key:0},[s("div",{class:N(["editor-choose",{active:t.status==="EDITOR"}])},[z(C,{class:N(["picker",{disabled:t.disabledPicker}]),range:t.mapNameList,onChoose:a[2]||(a[2]=o=>t.activeMapUuid=t.mapList[o].uuid),disabled:t.disabledPicker},{default:he(()=>[we(d(t.mapMapName[t.activeMapUuid]||l.$t("map.ChMa"))+" ",1),t.disabledPicker?x("",!0):(f(),g("svg",xe,Ie))]),_:1},8,["class","range","disabled"])],2),s("div",{class:N(["editor-box",{active:t.status==="EDITOR"}]),ref:"editorBox"},[s("div",De,d(l.$t("map.RoNa")),1),V(s("input",{type:"text",class:"name-input","onUpdate:modelValue":a[3]||(a[3]=o=>t.focusTask.name=o),placeholder:l.$t("map.PERN")},null,8,Le),[[be,t.focusTask.name]]),s("div",Ee,[s("span",null,d(l.$t("map.RoDe")),1),(f(),g("svg",{class:"icon",onClick:a[4]||(a[4]=(...o)=>t.changeAllStayTime&&t.changeAllStayTime(...o)),viewBox:"0 0 1024 1024",width:"32",height:"32",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},Ue))]),V(s("div",{class:"list-box",ref:"listBox",onFingerdown:a[5]||(a[5]=(...o)=>t.onFingerDown&&t.onFingerDown(...o)),onFingermove:a[6]||(a[6]=(...o)=>t.onFingerMove&&t.onFingerMove(...o)),onFingerup:a[7]||(a[7]=(...o)=>t.onFingerUp&&t.onFingerUp(...o))},[s("table",null,[s("thead",null,[s("tr",null,[Oe,s("th",null,d(l.$t("map.WaMa")),1),s("th",Be,d(l.$t("map.StOv")),1)])]),s("tbody",null,[(f(!0),g(L,null,H(t.focusTask.list,(o,v)=>(f(),g("tr",{key:v,class:N({active:t.dragIndex===v})},[s("td",ze,d(v+1)+".",1),s("td",null,[s("div",{class:"name",onClick:b=>t.toMapPoint(o)},d(o.name)+"("+d(t.mapMapName[o.map_uuid]||"NONE")+")",9,Ge)]),s("td",null,[s("div",{class:"time",onClick:b=>t.changeStayTime(o)},d(o.stay_time)+"s",9,je)]),s("td",null,[s("div",{class:"remove",onClick:b=>t.focusTask.list.splice(v,1)},Ve,8,qe)])],2))),128)),s("tr",{class:N({active:t.focusTask.list&&t.dragIndex===t.focusTask.list.length})},Je,2)])])],544),[[R]]),s("div",We,[s("div",{class:"btn cls",onClick:a[8]||(a[8]=(...o)=>t.cancelEditor&&t.cancelEditor(...o))},d(l.$t("btn.Canc")),1),s("div",{class:"btn del",onClick:a[9]||(a[9]=(...o)=>t.delTask&&t.delTask(...o))},d(l.$t("btn.Dele")),1),s("div",{class:"btn save",onClick:a[10]||(a[10]=(...o)=>t.saveTask&&t.saveTask(...o))},d(l.$t("btn.Save")),1)])],2)],64)),(f(),g(L,{key:1},[s("div",{class:N(["editor-title",{active:t.status==="RUNNING"}])},d(t.mapMapName[t.activeMapUuid]),3),t.status==="RUNNING"&&t.robotStatus.cruise_active?(f(),g("div",Ye,d(l.$t("sc.Recu")),1)):x("",!0),s("div",{class:N(["run-btns",{active:t.status==="RUNNING"}])},[t.robotStatus.cruise_status===2?(f(),g("div",{key:0,class:"btn",onClick:a[11]||(a[11]=(...o)=>t.pauseCruise&&t.pauseCruise(...o))},d(l.$t("btn.Paus")),1)):x("",!0),t.robotStatus.cruise_status===4?(f(),g("div",{key:1,class:"btn",onClick:a[12]||(a[12]=(...o)=>t.nextCruise&&t.nextCruise(...o))},d(l.$t("btn.Resu")),1)):x("",!0),s("div",{class:"btn",onClick:a[13]||(a[13]=(...o)=>t.stopCruise&&t.stopCruise(...o))},d(l.$t("btn.Stop")),1)],2)],64))])}var et=ue(ye,[["render",Ke]]);export{et as default};
