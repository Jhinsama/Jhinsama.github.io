!function(t,e){"use strict";function i(t,e,i,s){s?t.removeEventListener?t.removeEventListener(e,i):t.detachEvent?(t.detachEvent("on"+e,t[e+i]),t[e+i]=null,t["e"+e+i]=null):t["on"+e]=null:t.addEventListener?t.addEventListener(e,i):t.attachEvent?(t["e"+e+i]=i,t[e+i]=function(){t["e"+e+i](window.event)},t.attachEvent("on"+e,t[e+i])):t["on"+e]=i}function s(t,e){if(t.getElementsByClassName)return t.getElementsByClassName(e);for(var i=[],s=t.getElementsByTagName("*"),a=0;a<s.length;a++)for(var n=s[a].className.split(" "),r=0;r<n.length;r++)if(n[r]===e){i.push(s[a]);break}return i}function a(t,e){if(!t.className)return t.className=e;for(var i=t.className.split(" "),s=!1,a=0;a<i.length;a++)i[a]===e&&(s=!0);s||(t.className+=" "+e)}function n(t,e){if(!t.className||t.className==e)return t.className="";for(var i=t.className.split(" "),s=0;s<i.length;s++)i[s]===e&&(i.splice(s,1),t.className=i.join(" "))}function r(t,e){if(!t.className)return!1;for(var i=!1,s=t.className.split(" "),a=0;a<s.length;a++)s[a]===e&&(i=!0);return i}function h(t,e){for(var i=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector;t&&!i.call(t,e);)t=t.parentElement;return t}function o(t,e){if(document.createEventObject){var i=document.createEventObject();return t.fireEvent("on"+e,i)}return(i=document.createEvent("HTMLEvents")).initEvent(e,!0,!0),!t.dispatchEvent(i)}function c(){this.join="-",this.wW=t.innerWidth,this.wH=t.innerHeight,this.touchState={},this.inputs=Array.prototype.slice.call(s(document,"datepicker"),0),this.maxID=(new Date).getTime(),this._init()}t.datePicker||(c.prototype={set:function(t,e){var s=e instanceof Object;if(t instanceof HTMLElement)if("input"==t.nodeName.toLowerCase()){for(var a=!1,n=0;n<this.inputs.length;n++)if(this.inputs[n]===t){a=!0;break}a||(i(t,"focus",this._inputFocus.bind(this,t)),this.inputs.push(t),t.type="text",s&&(t.datePickerData={range:e.range||null,min:e.min||null,max:e.max||null,bind:e.bind||null}))}else console.dir(t);else try{for(var r=t.length,n=0;n<r;n++){var h=t[n];if(h instanceof HTMLElement)if("input"==h.nodeName.toLowerCase()){for(var a=!1,o=0;o<this.inputs.length;o++)if(this.inputs[o]===h){a=!0;break}a||(i(h,"focus",this._inputFocus.bind(this,h)),this.inputs.push(h),h.type="text",s&&(h.datePickerData={range:e.range||null,min:e.min||null,max:e.max||null,bind:e.bind||null}))}else console.dir(h);else console.dir(h)}}catch(t){console.log("传入的元素或许不是输入框")}},prev:function(){return this.currentMonth--,this.currentMonth<0?(this.yearBox.style.cssText="",this.yearBox.innerHTML="",this.currentMonth=11,this.yearBox.setAttribute("data-month",11),this.currentYear--,this._mosaicObj(this.currentYear)):(this.yearBox.style.cssText="-webkit-transition:300ms;-moz-transition:300ms;-ms-transition:300ms;-o-transition:300ms;transition:300ms;",this.yearBox.setAttribute("data-month",this.currentMonth)),this.ymBtn.innerHTML=this.currentYear+"年"+(this.currentMonth<9?"0"+(this.currentMonth+1):this.currentMonth+1)+"月",!0},next:function(){return this.currentMonth++,this.currentMonth>11?(this.yearBox.style.cssText="",this.yearBox.innerHTML="",this.currentMonth=0,this.yearBox.setAttribute("data-month",0),this.currentYear++,this._mosaicObj(this.currentYear)):(this.yearBox.style.cssText="-webkit-transition:300ms;-moz-transition:300ms;-ms-transition:300ms;-o-transition:300ms;transition:300ms;",this.yearBox.setAttribute("data-month",this.currentMonth)),this.ymBtn.innerHTML=this.currentYear+"年"+(this.currentMonth<9?"0"+(this.currentMonth+1):this.currentMonth+1)+"月",!0},_init:function(){this._initInputs();var t=new Date;this.currentYear=t.getFullYear(),this.currentMonth=t.getMonth(),this.day={},this._create()&&(this._getElement()._mosaicObj(this.currentYear),this._initEvent())},_reSize:function(){this.wW=t.innerWidth,this.wH=t.innerHeight,this.datePickerW=this.datePicker.offsetWidth,this.datePickerH=this.datePicker.offsetHeight},_create:function(){var t=document.createElement("style");return t.type="text/css",t.innerHTML="",document.getElementsByTagName("head")[0].appendChild(t),this.datePicker=document.createElement("div"),this.datePicker.className="-date-picker",this.datePicker.innerHTML="<div class='-date-picker-point'><div class='-rotate45'></div></div><div class='-date-picker-main'><div class='-date-picker-foot'><div><div class='-date-picker-ym -d-p-middle'><button id='-date-picker-ym'>"+this.currentYear+"年"+(this.currentMonth<9?"0"+(this.currentMonth+1):this.currentMonth+1)+"月</button><span class='-dpcymt -rotate45'></span></div></div></div><div class='-date-picker-day'><div><div class='-date-picker-title'><span class='-d-p-middle'>日</span><span class='-d-p-middle'>一</span><span class='-d-p-middle'>二</span><span class='-d-p-middle'>三</span><span class='-d-p-middle'>四</span><span class='-d-p-middle'>五</span><span class='-d-p-middle'>六</span></div><div class='-date-picker-prev'><div class='-rotate45'></div></div><div class='-date-picker-box'><div id='-date-picker-year' data-month='"+this.currentMonth+"' style='-webkit-transition:300ms;-moz-transition:300ms;-ms-transition:300ms;-o-transition:300ms;transition:300ms;'></div></div><div class='-date-picker-next'><div class='-rotate45'></div></div></div></div><div class='-date-picker-btn'><div><div><button class='-date-picker-btn-tday'>今&emsp;天</button></div><div><button class='-date-picker-btn-ystday'>昨&emsp;天</button></div><div><button class='-date-picker-btn-lsweek'>上一周</button></div><div><button class='-date-picker-btn-lsmonth'>上一月</button></div></div></div></div>",document.body.appendChild(this.datePicker),this.datePickerW=this.datePicker.offsetWidth,this.datePickerH=this.datePicker.offsetHeight,this.datePicker.style.display="none",!0},_getElement:function(){return this.point=s(this.datePicker,"-date-picker-point")[0],this.yearMonth=s(this.datePicker,"-date-picker-ym")[0],this.ymBtn=document.getElementById("-date-picker-ym"),this.box=s(this.datePicker,"-date-picker-box")[0],this.yearBox=document.getElementById("-date-picker-year"),this.prevEl=s(this.datePicker,"-date-picker-prev")[0],this.nextEl=s(this.datePicker,"-date-picker-next")[0],this.today=s(this.datePicker,"-date-picker-btn-tday")[0],this.yesterday=s(this.datePicker,"-date-picker-btn-ystday")[0],this.lastWeek=s(this.datePicker,"-date-picker-btn-lsweek")[0],this.lastMonth=s(this.datePicker,"-date-picker-btn-lsmonth")[0],this},_initPicker:function(t){var e=new Date,i=e.getFullYear(),s=e.getMonth(),r=!1;this.dateCache||(i!=this.currentYear&&(this.currentYear=i,this._mosaicObj(i),r=!0),s!=this.currentMonth&&(this.currentMonth=s,this.yearBox.setAttribute("data-month",s),r=!0),r&&(this.ymBtn.innerHTML=this.currentYear+"年"+(this.currentMonth<9?"0"+(this.currentMonth+1):this.currentMonth+1)+"月"),t.datePickerData.range?(n(this.lastWeek,"un"),n(this.lastMonth,"un")):(a(this.lastWeek,"un"),a(this.lastMonth,"un")));var h=t.offsetTop,o=t.offsetHeight,c=t.offsetLeft;t.offsetWidth;this.datePicker.style.top=h+o+"px",c+this.datePickerW>this.wW?(this.datePicker.style.left=this.wW-this.datePickerW+"px",this.point.style.left=c-this.wW+this.datePickerW+15+"px"):(this.datePicker.style.left=c+"px",this.point.style.left="10%")},_inputFocus:function(e){return e.blur(),this._inputBlur(e),this.input=e,this._initPicker(e),this.datePicker.style.display="block",t.scrollTo(0,e.offsetTop-5),!1},_inputBlur:function(t){if(this.dateCache)if(this.dateCache.start&&this.dateCache.end){if(this.dateCache.start!=t&&this.dateCache.end!=t){var i;if("start"==this.dateCache.on){var s=this.dateCache.end.datePickerData.max;if("now"==s){var a=new Date;i=this._mosaicStr(a.getFullYear(),a.getMonth(),a.getDate())}else i=s.replace(".",this.join).replace(".",this.join).replace("."," ").replace(".",":").replace(".",":");this.dateCache.end.value=i}else this.dateCache.end.datePickerData.min;this.dateCache=e}}else t!=this.input&&(this.dateCache=e)},_disableEvent:function(e){return(e=e||t.event).preventDefault(),e.stopPropagation(),!1},_defaultTouch:function(e){var i=h((e=e||t.event).target,".-date-picker"),s=h(e.target,"input"),a=!0;if(s)for(var n=0;n<this.inputs.length;n++)if(this.inputs[n]===s){a=!1;break}!i&&a&&(this.datePicker.style.display="none",this._inputBlur())},_touchStart:function(e){var i=i||t.event;this.touchState.startX=this.touchState.moveX=i.touches[0].clientX,this.touchState.startY=this.touchState.moveY=i.touches[0].clientY,e===this.box&&(this.boxH=this.box.offsetHeight)},_touchMove:function(e){var i=i||t.event,s=i.touches[0].clientY;if(this.touchState.moveY=s,e===this.box){var a=this.currentMonth*this.boxH+this.touchState.startY-s;this.yearBox.style.cssText="-webkit-transform: translateY("+-a+"px) translateZ(0);-moz-transform: translateY("+-a+"px) translateZ(0);-ms-transform: translateY("+-a+"px) translateZ(0);-o-transform: translateY("+-a+"px) translateZ(0);transform: translateY("+-a+"px) translateZ(0);"}},_touchEnd:function(t){if(t===this.box){var e=this.touchState.moveY-this.touchState.startY,i=Math.abs(e)>=this.boxH/4;e>0?i?this.prev():this.yearBox.style.cssText="-webkit-transition:300ms;-moz-transition:300ms;-ms-transition:300ms;-o-transition:300ms;transition:300ms;":e<0&&(i?this.next():this.yearBox.style.cssText="-webkit-transition:300ms;-moz-transition:300ms;-ms-transition:300ms;-o-transition:300ms;transition:300ms;")}},_click:function(i){var s=s||t.event;if(s.preventDefault(),s.stopPropagation(),i instanceof HTMLElement){if(i===this.yearMonth);else if(i===this.prevEl)this.prev();else if(i===this.nextEl)this.next();else if(i===this.today){c=new Date;this.input.value=this._mosaicStr(c.getFullYear(),c.getMonth(),c.getDate());var a=this.input.datePickerData.bind,n=this.input.datePickerData.range;if(a&&"start"==n||"end"==n){for(g=0;g<this.inputs.length;g++)if(this.inputs[g].datePickerData.bind==a&&this.inputs[g].datePickerData.range!=n){b=this.inputs[g];break}b&&(b.value=this.input.value)}this.datePicker.style.display="none"}else if(i===this.yesterday){var c=new Date,d=this._testDay(c.getFullYear(),c.getMonth(),c.getDate()-1);this.input.value=this._mosaicStr(d.year,d.month,d.day);var a=this.input.datePickerData.bind,n=this.input.datePickerData.range;if(a&&"start"==n||"end"==n){for(g=0;g<this.inputs.length;g++)if(this.inputs[g].datePickerData.bind==a&&this.inputs[g].datePickerData.range!=n){b=this.inputs[g];break}b&&(b.value=this.input.value)}this.datePicker.style.display="none"}else if(i===this.lastWeek){if(r(i,"un"))return!1;var u=(c=new Date).getDay()||7,l=c.getFullYear(),p=c.getMonth();(f=c.getDate()-u)<0?(m={year:(d=this._testDay(l,p,f)).year,month:d.month,day:d.day-6},v={year:d.year,month:d.month,day:d.day}):(v={year:l,month:p,day:f},m={year:(d=this._testDay(c.getFullYear(),c.getMonth(),f-6)).year,month:d.month,day:d.day});var a=this.input.datePickerData.bind,n=this.input.datePickerData.range;if(a&&"start"==n||"end"==n){for(g=0;g<this.inputs.length;g++)if(this.inputs[g].datePickerData.bind==a&&this.inputs[g].datePickerData.range!=n){b=this.inputs[g];break}b?"start"==n?(this.input.value=this._mosaicStr(m.year,m.month,m.day),b.value=this._mosaicStr(v.year,v.month,v.day)):(b.value=this._mosaicStr(m.year,m.month,m.day),this.input.value=this._mosaicStr(v.year,v.month,v.day)):this.input.value=this._mosaicStr(m.year,m.month,m.day)+" / "+this._mosaicStr(v.year,v.month,v.day)}else this.input.value=this._mosaicStr(m.year,m.month,m.day)+" / "+this._mosaicStr(v.year,v.month,v.day);this.datePicker.style.display="none"}else if(i===this.lastMonth){if(r(i,"un"))return!1;var m,v,c=new Date;m={year:(d=this._testDay(c.getFullYear(),c.getMonth(),0)).year,month:d.month,day:1},v={year:d.year,month:d.month,day:d.day};var a=this.input.datePickerData.bind,n=this.input.datePickerData.range;if(a&&"start"==n||"end"==n){for(g=0;g<this.inputs.length;g++)if(this.inputs[g].datePickerData.bind==a&&this.inputs[g].datePickerData.range!=n){b=this.inputs[g];break}b?"start"==n?(this.input.value=this._mosaicStr(m.year,m.month,m.day),b.value=this._mosaicStr(v.year,v.month,v.day)):(b.value=this._mosaicStr(m.year,m.month,m.day),this.input.value=this._mosaicStr(v.year,v.month,v.day)):this.input.value=this._mosaicStr(m.year,m.month,m.day)+" / "+this._mosaicStr(v.year,v.month,v.day)}else this.input.value=this._mosaicStr(m.year,m.month,m.day)+" / "+this._mosaicStr(v.year,v.month,v.day);this.datePicker.style.display="none"}this.dateCache=e}else if(h(s.target,".-date-picker-date")){var y=h(s.target,".-date-picker-date");if(r(y,"prev"))this.prev();else if(r(y,"next"))this.next();else{if(r(y,"un"))return!1;var l=this.currentYear,p=this.currentMonth+1,f=~~y.innerText,a=this.input.datePickerData.bind;if(n=this.input.datePickerData.range){var k=this._mosaicStr(l,p,f);if(a&&"start"==n||"end"==n)if(this.dateCache){d=this._sortDay(this.dateCache.str,k);this.dateCache.start.value=d.min,this.dateCache.end.value=d.max,this.datePicker.style.display="none",this.dateCache=e}else{this.input.value=k,this.dateCache={str:k};for(var b,g=0;g<this.inputs.length;g++)if(this.inputs[g].datePickerData.bind==a&&this.inputs[g].datePickerData.range!=n){b=this.inputs[g];break}b?("start"==n?(this.dateCache.start=this.input,this.dateCache.end=b):(this.dateCache.end=this.input,this.dateCache.start=b),this.dateCache.on=n,o(b,"focus")):this.datePicker.style.display="none"}else this.dateCache?(k=(d=this._sortDay(this.dateCache.str,k)).min+" / "+d.max,this.dateCache=e,this.input.value=k,this.datePicker.style.display="none"):(this.dateCache={str:k},this.input.value=k)}else this.input.value=this._mosaicStr(l,p,f),this.datePicker.style.display="none"}}return!1},_sortDay:function(t,e){var i,s;return new Date(t.replace(this.join,"/").replace(this.join,"/"))>new Date(e.replace(this.join,"/").replace(this.join,"/"))?(i=t,s=e):(s=t,i=e),{max:i,min:s}},_testDay:function(t,e,i){return i<1&&(--e<0&&(e=11,t--),i+=0==e||2==e||4==e||6==e||7==e||9==e||11==e?31:3==e||5==e||8==e||10==e?30:t%4==0?29:28),{year:t,month:e,day:i}},_mouseWheel:function(){if(this.scroll)return!1;this.scroll=!0;var e=e||t.event;e.preventDefault(),e.stopPropagation();var i=e.detail,s=e.wheelDelta;return i?i>0?this.next():this.prev():s>0?this.prev():this.next(),delete this.scroll,!1},_initInputs:function(){for(var t={},e=[],i=0;i<this.inputs.length;i++)if("input"==this.inputs[i].nodeName.toLowerCase()){this.inputs[i].datePickerData={range:this.inputs[i].getAttribute("range"),max:this.inputs[i].getAttribute("max"),min:this.inputs[i].getAttribute("min"),bind:this.inputs[i].getAttribute("bind")};var s=this.inputs[i].datePickerData.bind;if(s){var a=this.inputs[i].datePickerData.min,n=this.inputs[i].datePickerData.max;t[s]||(t[s]={inputs:[],min:null,max:null}),n&&(t[s].max=n),a&&(t[s].min=a),t[s].inputs.push(this.inputs[i])}}else e.push(i);for(var r in t)for(var h=t[r].inputs,i=0;i<h.length;i++)h[i].datePickerData.min=t[r].min,h[i].datePickerData.max=t[r].max;for(i=0;i<e.length;i++)this.inputs.splice(i,1)},_initEvent:function(){for(var e=0;e<this.inputs.length;e++)i(this.inputs[e],"focus",this._inputFocus.bind(this,this.inputs[e]));i(this.datePicker,"touchmove",this._disableEvent),i(this.datePicker,"click",this._click.bind(this)),i(this.prevEl,"click",this._click.bind(this,this.prevEl)),i(this.nextEl,"click",this._click.bind(this,this.nextEl)),i(this.today,"click",this._click.bind(this,this.today)),i(this.yesterday,"click",this._click.bind(this,this.yesterday)),i(this.lastWeek,"click",this._click.bind(this,this.lastWeek)),i(this.lastMonth,"click",this._click.bind(this,this.lastMonth)),i(document,"touchstart",this._defaultTouch.bind(this)),i(document,"mousedown",this._defaultTouch.bind(this)),i(t,"resize",this._reSize.bind(this)),i(this.box,"touchstart",this._touchStart.bind(this,this.box)),i(this.box,"touchmove",this._touchMove.bind(this,this.box)),i(this.box,"touchend",this._touchEnd.bind(this,this.box)),i(this.box,"touchcancel",this._touchEnd.bind(this,this.box)),/.*Firefox.*/.test(navigator.userAgent)?i(this.box,"DOMMouseScroll",this._mouseWheel.bind(this)):i(this.box,"mousewheel",this._mouseWheel.bind(this))},_mosaicObj:function(t){var e="<div class='-prev-year'>上一年</div>";if(this.day[t])for(i=0;i<12;i++)e+=this.day[t][i];else{this.day[t]=[];for(var i=1;i<=12;i++){var s=this._mosaicMonth(t,i);this.day[t][i-1]=s,e+=s}}e+="<div class='-next-year'>下一年</div>",this.yearBox.innerHTML=e},_mosaicMonth:function(t,e){var i=!1;t%4==0&&(i=!0);var s=0,a="<div class='-date-picker-month'><div class='-before'>"+e+"</div><div class='-after'>"+e+"</div>",n=new Date(t+"/"+e+"/1").getDay();n=0==n?7:n,a+=1==e||2==e||4==e||6==e||9==e||11==e?this._mosaicDate(t,e,n,31-n):5==e||7==e||8==e||10==e||12==e?this._mosaicDate(t,e,n,30-n):i?this._mosaicDate(t,e,n,29-n):this._mosaicDate(t,e,n,28-n),s+=n,1==e||3==e||5==e||7==e||8==e||10==e||12==e?(a+=this._mosaicDate(t,e,31),s+=31):4==e||6==e||9==e||11==e?(a+=this._mosaicDate(t,e,30),s+=30):i?(a+=this._mosaicDate(t,e,29),s+=29):(a+=this._mosaicDate(t,e,28),s+=28);var r=42-s;return a+=this._mosaicDate(t,e,r),a+="</div>"},_mosaicDate:function(t,e,i,s){var a=new Date,n=a.getFullYear(),r=a.getMonth()+1,h=a.getDate()-1,o="";s=s||0;for(var c=0;c<i;c++)s>0||i<28?(o+=s>0?"<button class='-date-picker-date un prev'>":"<button class='-date-picker-date un next'>",c+s<9&&(o+="&ensp;"),o+=c+s+1,o+="</button>"):(o+=c==h&&e==r&&t==n?"<button class='-date-picker-date in'>":"<button class='-date-picker-date'>",c<9&&(o+="&ensp;"),o+=c+1,o+="</button>");return o},_mosaicStr:function(t,i,s,a,n,r){var h;return h=t+this.join+(i<9?"0"+(i+1):i+1)+this.join+(s<10?"0"+s:s),a!=e&&(h+=" ",h+=a,h+=":",h+=n?n<10?"0"+n:n:"00",h+=":",h+=r?r<10?"0"+r:r:"00"),h}},t.datePicker=c)}(window,void 0);