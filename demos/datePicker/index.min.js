!function(t,e){"use strict";t.DatePicker||(d.prototype={_init:function(t){this._setFormat(t),this._initInputs();var e=new Date;this.currentYear=e.getFullYear(),this.currentMonth=e.getMonth(),this.day={},this._create()&&(this._getElement()._mosaicObj(this.currentYear),this._initEvent()),this.api={set:this.set.bind(this),get:this.setCB.bind(this)}},set:function(t,e){var s;if(t.length)s=t;else{if(!(t instanceof Object))return console.log("传入的元素不是输入框"),this.api;s=[t]}for(var a,n=0;n<s.length;n++)if(a=!1,1==(t=s[n]).nodeType&&"input"==t.nodeName.toLowerCase()){for(var r=0;r<this.inputs.length;r++)if(this.inputs[r]===t){a=!0;break}a||(i(t,"focus",this._inputFocus.bind(this,t)),this.inputs.push(t),t.type="text"),e instanceof Object&&(t.datePickerData={min:e.min||null,max:e.max||null},e.range&&(e.bind?0==n?(t.datePickerData.range="start",t.datePickerData.bind=e.bind):1==n?(t.datePickerData.range="end",t.datePickerData.bind=e.bind):t.datePickerData.range="self":t.datePickerData.range="self"))}else console.log(t,"不是输入框");return this.api},setCB:function(t){return t instanceof Function&&(this.callback=t),this.api},prev:function(){var t=this.currentMonth-1;if(t<0){var e=this.currentYear-1;if(e<this.min.year)return!0;this.currentYear=e,this._setYearBox(1,11)}else{if(this.currentYear<=this.min.year&&t<this.min.month)return!0;this.currentMonth=t,this._setYearBox(0,this.currentMonth)}return this.ymBtn.innerHTML=this.currentYear+"年"+(this.currentMonth<9?"0"+(this.currentMonth+1):this.currentMonth+1)+"月",!0},next:function(){var t=this.currentMonth+1;if(t>11){var e=this.currentYear+1;if(e>this.max.year)return!0;this.currentYear=e,this._setYearBox(1,0)}else{if(this.currentYear>=this.max.year&&t>this.max.month)return!0;this.currentMonth=t,this._setYearBox(0,this.currentMonth)}return this.ymBtn.innerHTML=this.currentYear+"年"+(this.currentMonth<9?"0"+(this.currentMonth+1):this.currentMonth+1)+"月",!0},_setYearBox:function(t,e,i){i?(i=-i,this.yearBox.style.cssText="-webkit-transform: translateY("+i+"px) translateZ(0);-moz-transform: translateY("+i+"px) translateZ(0);-ms-transform: translateY("+i+"px) translateZ(0);-o-transform: translateY("+i+"px) translateZ(0);transform: translateY("+i+"px) translateZ(0);"):t?(this.yearBox.style.cssText="",this.yearBox.innerHTML="",this.currentMonth=e,this.yearBox.setAttribute("data-month",e),this._mosaicObj(this.currentYear)):(this.yearBox.style.cssText="-webkit-transition:300ms;-moz-transition:300ms;-ms-transition:300ms;-o-transition:300ms;transition:300ms;","number"==typeof e&&this.yearBox.setAttribute("data-month",e))},_prev:function(t){if(!t)return!1;0==this.yearRangePosition&&this._setYearBtnBox(this.yearRangePosition,1);t=t||1;var e=this.yearRangePosition-t;e=e<0?0:e,this.yearRangePosition=e,e*=25,this._setYearBtnBox(e,1)},_next:function(t){if(!t)return!1;var e=this.yearBtns.length/3-4;this.yearRangePosition==e&&this._setYearBtnBox(this.yearRangePosition,1);t=t||1;var i=this.yearRangePosition+t;i=i>e?e:i,this.yearRangePosition=i,i*=25,this._setYearBtnBox(i,1)},_setYearBtnBox:function(t,e){var i="-webkit-transform: translateY("+(t=-t)+"%) translateZ(0);-moz-transform: translateY("+t+"%) translateZ(0);-ms-transform: translateY("+t+"%) translateZ(0);-o-transform: translateY("+t+"%) translateZ(0);transform: translateY("+t+"%) translateZ(0);";e&&(i+="-webkit-transition:300ms;-moz-transition:300ms;-ms-transition:300ms;-o-transition:300ms;transition:300ms;"),this.yearBtnBox.style.cssText=i},_back:function(){var t=this.datePicker;r(t,"-year")?n(t,"-year"):n(t,"-show")},_create:function(){var t=document.createElement("style");return t.type="text/css",t.innerHTML="",document.getElementsByTagName("head")[0].appendChild(t),this.datePicker=document.createElement("div"),this.datePicker.className="-date-picker",this.datePicker.innerHTML="<div class='-date-picker-point'><div class='-rotate45'></div></div><div class='-date-picker-main'><div class='-date-picker-foot'><div><div class='-date-picker-ym -d-p-middle'><button id='-date-picker-ym'>"+this.currentYear+"年"+(this.currentMonth<9?"0"+(this.currentMonth+1):this.currentMonth+1)+"月</button><span class='-dpcymt -rotate45'></span></div></div></div><div class='-date-picker-day'><div><div class='-date-picker-title'><span class='-d-p-middle'>日</span><span class='-d-p-middle'>一</span><span class='-d-p-middle'>二</span><span class='-d-p-middle'>三</span><span class='-d-p-middle'>四</span><span class='-d-p-middle'>五</span><span class='-d-p-middle'>六</span></div><div class='-date-picker-prev'><div class='-rotate45'></div></div><div class='-date-picker-box'><div id='-date-picker-year' data-month='"+this.currentMonth+"' style='-webkit-transition:300ms;-moz-transition:300ms;-ms-transition:300ms;-o-transition:300ms;transition:300ms;'></div></div><div class='-date-picker-next'><div class='-rotate45'></div></div></div></div><div class='-date-picker-btn'><div><div><button class='-date-picker-btn-tday'>今&emsp;天</button></div><div><button class='-date-picker-btn-ystday'>昨&emsp;天</button></div><div><button class='-date-picker-btn-lsweek'>上一周</button></div><div><button class='-date-picker-btn-lsmonth'>上一月</button></div></div></div><div class='-date-picker-select'><div class='-d-p-select-head'><div><div class='-d-p-select-year-touch'><div class='-d-p-select-left'></div><div class='-d-p-select-box'><div id='-d-p-select-year'></div></div><div class='-d-p-select-right'></div></div><button class='-d-p-select-year-range'></button></div></div><div class='-d-p-select-year-month'><div><div class='-d-p-s-year-box'><div class='-d-p-s-year-prev '><div class='-rotate45'></div></div><div class='-d-p-s-y-box'><div id='-d-p-s-y-box'></div></div><div class='-d-p-s-year-next'><div class='-rotate45'></div></div></div><div class='-d-p-s-month-box'><div class='-d-p-s-month' date-month='1'><div class='-d-p-middle'>一月<div class='-d-p-s-m-en'>Jan</div></div></div><div class='-d-p-s-month' date-month='2'><div class='-d-p-middle'>二月<div class='-d-p-s-m-en'>Fed</div></div></div><div class='-d-p-s-month' date-month='3'><div class='-d-p-middle'>三月<div class='-d-p-s-m-en'>Mar</div></div></div><div class='-d-p-s-month' date-month='4'><div class='-d-p-middle'>四月<div class='-d-p-s-m-en'>Apr</div></div></div><div class='-d-p-s-month' date-month='5'><div class='-d-p-middle'>五月<div class='-d-p-s-m-en'>May</div></div></div><div class='-d-p-s-month' date-month='6'><div class='-d-p-middle'>六月<div class='-d-p-s-m-en'>Jun</div></div></div><div class='-d-p-s-month' date-month='7'><div class='-d-p-middle'>七月<div class='-d-p-s-m-en'>Jul</div></div></div><div class='-d-p-s-month' date-month='8'><div class='-d-p-middle'>八月<div class='-d-p-s-m-en'>Aug</div></div></div><div class='-d-p-s-month' date-month='9'><div class='-d-p-middle'>九月<div class='-d-p-s-m-en'>Sep</div></div></div><div class='-d-p-s-month' date-month='10'><div class='-d-p-middle'>十月<div class='-d-p-s-m-en'>Oct</div></div></div><div class='-d-p-s-month' date-month='11'><div class='-d-p-middle'>十一月<div class='-d-p-s-m-en'>Nov</div></div></div><div class='-d-p-s-month' date-month='12'><div class='-d-p-middle'>十二月<div class='-d-p-s-m-en'>Dec</div></div></div></div></div></div></div></div>",document.body.appendChild(this.datePicker),this.datePickerW=this.datePicker.offsetWidth,this.datePickerH=this.datePicker.offsetHeight,this.datePicker.style.display="none",!0},_getElement:function(){return this.point=s(this.datePicker,"-date-picker-point")[0],this.yearMonth=s(this.datePicker,"-date-picker-ym")[0],this.ymBtn=document.getElementById("-date-picker-ym"),this.box=s(this.datePicker,"-date-picker-box")[0],this.yearBox=document.getElementById("-date-picker-year"),this.prevEl=s(this.datePicker,"-date-picker-prev")[0],this.nextEl=s(this.datePicker,"-date-picker-next")[0],this.today=s(this.datePicker,"-date-picker-btn-tday")[0],this.yesterday=s(this.datePicker,"-date-picker-btn-ystday")[0],this.lastWeek=s(this.datePicker,"-date-picker-btn-lsweek")[0],this.lastMonth=s(this.datePicker,"-date-picker-btn-lsmonth")[0],this.yearTouch=s(this.datePicker,"-d-p-select-year-touch")[0],this.yearTouchInner=document.getElementById("-d-p-select-year"),this.yearRange=s(this.datePicker,"-d-p-select-year-range")[0],this.yearPrev=s(this.datePicker,"-d-p-s-year-prev")[0],this.yearNext=s(this.datePicker,"-d-p-s-year-next")[0],this.yearBtnBox=document.getElementById("-d-p-s-y-box"),this.monthBtnBox=s(this.datePicker,"-d-p-s-month-box")[0],this.monthBtns=s(this.datePicker,"-d-p-s-month"),this},_initInputs:function(){for(var t={},e=[],i=0;i<this.inputs.length;i++)if("input"==this.inputs[i].nodeName.toLowerCase()){this.inputs[i].datePickerData={range:this.inputs[i].getAttribute("range"),max:this.inputs[i].getAttribute("max"),min:this.inputs[i].getAttribute("min"),bind:this.inputs[i].getAttribute("bind")};var s=this.inputs[i].datePickerData.bind;if(s){var a=this.inputs[i].datePickerData.min,n=this.inputs[i].datePickerData.max;t[s]||(t[s]={inputs:[],min:null,max:null}),n&&(t[s].max=n),a&&(t[s].min=a),t[s].inputs.push(this.inputs[i])}}else e.push(i);for(var r in t){var h=t[r].inputs;for(i=0;i<h.length;i++)h[i].datePickerData.min=t[r].min,h[i].datePickerData.max=t[r].max}for(i=0;i<e.length;i++)this.inputs.splice(i,1)},_inputFocus:function(e){if(e.blur(),this._inputBlur(e),this.input=e,!this.dateCache){var i=new Date,s=e.datePickerData.min||"2008.01.01",a=e.datePickerData.max;a?"now"==a&&(a=i.getFullYear()+"."+(i.getMonth()+1)+"."+i.getDate()):a=i.getFullYear()+2+".12.31","now"==s&&(s=i.getFullYear()+"."+(i.getMonth()+1)+"."+i.getDate()),s=s.replace(/\D/g,".").replace(".","/").replace(".","/").replace("."," ").replace(".",":").replace(".",":"),a=a.replace(/\D/g,".").replace(".","/").replace(".","/").replace("."," ").replace(".",":").replace(".",":"),i=new Date(s),this.min={year:i.getFullYear(),month:i.getMonth(),day:i.getDate(),hours:i.getHours(),minute:i.getMinutes(),second:i.getSeconds()},i=new Date(a),this.max={year:i.getFullYear(),month:i.getMonth(),day:i.getDate(),hours:i.getHours(),minute:i.getMinutes(),second:i.getSeconds()}}var n=this._initPicker(e,s);this.datePicker.style.display="block";var r,h=n.top,o=n.height,c=this.wH-this.datePickerH-o;return this.scrollEl===t?(r=h-c,t.scrollTo(0,r)):(r=this.wH-this.datePickerH+this.scrollEl.scrollTop,this.scrollEl.scrollTop=r),!1},_initPicker:function(t,e){n(this.datePicker,"-year"),n(this.datePicker,"-show");var i=new Date,s=i.getFullYear(),r=i.getMonth(),h=i.getDay()||7,o=!1;if(!this.dateCache){this.active&&(this.active=void 0),s!=this.currentYear&&(this.currentYear=s,o=!0),r!=this.currentMonth&&(this.currentMonth=r,this.yearBox.setAttribute("data-month",r),o=!0),o&&(this.ymBtn.innerHTML=this.currentYear+"年"+(this.currentMonth<9?"0"+(this.currentMonth+1):this.currentMonth+1)+"月"),i.setHours(0),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(0);var c=new Date(e),d=(i-c)/1e3/60/60/24;d<0?a(this.today,"un"):n(this.today,"un"),d<1?a(this.yesterday,"un"):n(this.yesterday,"un"),!t.datePickerData.range||d-h<1?a(this.lastWeek,"un"):n(this.lastWeek,"un"),i.setDate(0),c.setDate(0),d=(i-c)/1e3/60/60/24,!t.datePickerData.range||d<1?a(this.lastMonth,"un"):n(this.lastMonth,"un"),this._mosaicObj(s)}var l=function(t){var e={top:t.offsetTop,left:t.offsetLeft,width:t.offsetWidth,height:t.offsetHeight};for(t=t.offsetParent;null!=t;)e.top+=t.offsetTop,e.left+=t.offsetLeft,t=t.offsetParent;return e}(t),u=l.top,v=l.height,m=l.left;l.width;return this.datePicker.style.top=u+v+"px",m+this.datePickerW>this.wW?(this.datePicker.style.left=this.wW-this.datePickerW+"px",this.point.style.left=m-this.wW+this.datePickerW+15+"px"):(this.datePicker.style.left=m+"px",this.point.style.left="10%"),l},_inputBlur:function(t){if(this.dateCache)if(this.dateCache.start&&this.dateCache.end){if(this.dateCache.start!=t&&this.dateCache.end!=t){var e;if("start"==this.dateCache.on){var i=this.dateCache.end.datePickerData.max;if("now"!=i&&i)e=i.replace(".",this.join).replace(".",this.join).replace("."," ").replace(".",":").replace(".",":");else{var s=new Date;e=this._mosaicStr(s.getFullYear(),s.getMonth(),s.getDate())}this.dateCache.end.value=e,this.callback&&this.callback({max:e,min:this.dateCache.str})}else{var a=this.dateCache.end.datePickerData.min;if(a)if("now"==a){s=new Date;e=this._mosaicStr(s.getFullYear(),s.getMonth(),s.getDate())}else e=a.replace(".",this.join).replace(".",this.join).replace("."," ").replace(".",":").replace(".",":");else e=this._mosaicStr(2008,0,1);this.dateCache.start.value=e,this.callback&&this.callback({max:this.dateCache.str,min:e})}this.dateCache=void 0,n(this.active.btn,"active"),this.active=void 0,this.btnArr={}}}else t!=this.input&&(this.callback&&this.callback(this.dateCache.str),this.dateCache=void 0,n(this.active.btn,"active"),this.active=void 0,this.btnArr={})},_disableEvent:function(e){return(e=e||t.event).preventDefault(),e.stopPropagation(),!1},_defaultTouch:function(e){var i=h((e=e||t.event).target,".-date-picker"),s=h(e.target,"input"),a=!0;if(s)for(var n=0;n<this.inputs.length;n++)if(this.inputs[n]===s){a=!1;break}!i&&a&&(this.datePicker.style.display="none",this._inputBlur())},_TouchS:function(e){var i=i||t.event;return this.touchState.startX=this.touchState.moveX=i.touches[0].clientX,this.touchState.startY=this.touchState.moveY=i.touches[0].clientY,e===this.box?this.boxH=this.box.offsetHeight:e===this.yearTouch?this.touchState.touchPosition=void 0:e===this.yearBtnBox?this.touchState.touchPosition=void 0:void 0},_TouchM:function(e){var i=i||t.event,s=i.touches[0].clientX,a=i.touches[0].clientY;if(this.touchState.moveX=s,this.touchState.moveY=a,e===this.box)this._setYearBox(0,0,this.currentMonth*this.boxH+this.touchState.startY-a);else if(e===this.yearTouch){var n=this.yearTouchPosition+(this.touchState.startX-s)/this.yearTouchInner.offsetWidth;this.touchState.touchPosition=n,n*=100,this.yearTouchInner.style.cssText="-webkit-transform: translateZ(0);-moz-transform: translateZ(0);-ms-transform: translateZ(0);-o-transform: translateZ(0);transform: translateZ(0);left: -"+n+"%;"}else{var r=this.yearRangePosition+(this.touchState.startY-a)/this.yearBtnBox.offsetHeight*4;this.touchState.touchPosition=r,r*=25,this._setYearBtnBox(r)}},_TouchE:function(t){if(t===this.box){var e=this.touchState.moveY-this.touchState.startY,i=Math.abs(e)>=this.boxH/4;e>0?(this._setYearBox(0,""),i&&this.prev()):e<0&&(this._setYearBox(0,""),i&&this.next())}else if(t===this.yearTouch){(s=this.touchState.touchPosition)&&(s=s%1<.5?~~s:1+~~s,this._setYTP(s))}else{var s;(s=this.touchState.touchPosition)&&(s=s%1<.5?~~s:1+~~s),(s-=this.yearRangePosition)<0?this._prev(1+~s):this._next(s)}},_mouseO:function(e){if(!this.active)return!1;if(e=e||t.event,this.btnArr.year!=this.currentYear||this.btnArr.month!=this.currentMonth){var i=s(this.yearBox,"-date-picker-month")[this.currentMonth];this.btnArr={year:this.currentYear,month:this.currentMonth,btns:s(i,"-date-picker-date")}}var r,o=this.btnArr.btns;if(r=h(e.target,".-date-picker-date")){var d=c(r)-2;if(this.currentYear>this.active.year)for(var l=0;l<o.length;l++)l>d?n(o[l],"on"):a(o[l],"on");else if(this.currentYear<this.active.year)for(l=0;l<o.length;l++)l<d?n(o[l],"on"):a(o[l],"on");else if(this.currentMonth>this.active.month)for(l=0;l<o.length;l++)l>d?n(o[l],"on"):a(o[l],"on");else if(this.currentMonth<this.active.month)for(l=0;l<o.length;l++)l<d?n(o[l],"on"):a(o[l],"on");else if(d>this.active.index)for(l=0;l<o.length;l++)l>this.active.index&&l<=d?a(o[l],"on"):n(o[l],"on");else if(d<this.active.index)for(l=0;l<o.length;l++)l>=d&&l<this.active.index?a(o[l],"on"):n(o[l],"on");else for(l=0;l<o.length;l++)n(o[l],"on")}},_mouseWheel:function(e){if(this.scroll)return!1;this.scroll=!0;var i=i||t.event;i.preventDefault(),i.stopPropagation();var s=i.detail,a=i.wheelDelta;return s?s>0?e==this.box?this.next():e==this.yearBtnBox?this._next():this._setYTP(this.yearTouchPosition+1):e==this.box?this.prev():e==this.yearBtnBox?this._prev():this._setYTP(this.yearTouchPosition-1):a>0?e==this.box?this.prev():e==this.yearBtnBox?this._prev():this._setYTP(this.yearTouchPosition-1):e==this.box?this.next():e==this.yearBtnBox?this._next():this._setYTP(this.yearTouchPosition+1),delete this.scroll,!1},_setYTP:function(t){var e=this.max.year-this.min.year+4;if(t=t<4?4:t>e?e:t,this.yearTouchInner.style.cssText="-webkit-transition:300ms;-moz-transition:300ms;-ms-transition:300ms;-o-transition:300ms;transition:300ms;-webkit-transform: translateZ(0);-moz-transform: translateZ(0);-ms-transform: translateZ(0);-o-transform: translateZ(0);transform: translateZ(0);left: -"+t+"00%;",4==t)for(var i=0;i<12;i++)i<this.min.month?a(this.monthBtns[i],"un"):n(this.monthBtns[i],"un");else if(t==e)for(i=0;i<12;i++)i>this.max.month?a(this.monthBtns[i],"un"):n(this.monthBtns[i],"un");else for(i=0;i<12;i++)n(this.monthBtns[i],"un");this.yearTouchPosition=t,this.cacheYear=this.min.year+t-4},_setRange:function(t,e){e||(e=t);var i=this.input.datePickerData.bind,s=this.input.datePickerData.range,a=this._sortDay(this._mosaicStr(t.year,t.month,t.day),this._mosaicStr(this.min.year,this.min.month,this.min.day)).max,n=this._mosaicStr(e.year,e.month,e.day);if(i&&"start"==s||"end"==s){for(var r,h=0;h<this.inputs.length;h++)if(this.inputs[h].datePickerData.bind==i&&this.inputs[h].datePickerData.range!=s){r=this.inputs[h];break}r?"start"==s?(this.input.value=a,r.value=n):(r.value=a,this.input.value=n):this.input.value=a+("/"==this.join?" - ":" / ")+n}else this.input.value=a+("/"==this.join?" - ":" / ")+n;this.datePicker.style.display="none",this.dateCache=void 0,this.callback&&this.callback({max:n,min:a})},_click:function(e){var i=i||t.event;if(i.preventDefault(),i.stopPropagation(),e===this.yearMonth){for(var n="",h=this.min.year-4,o=this.max.year+4,c=h;c<=o;c++)n+=c<h+4||c>o-4?"<button class='-d-p-s-y' style='color:#999'>":"<button class='-d-p-s-y'>",n+=c,n+="</button>";this.yearTouchInner.innerHTML=n,a(this.datePicker,"-show"),this._setYTP(this.currentYear-this.min.year+4)}else if(e===this.prevEl)this.prev();else if(e===this.nextEl)this.next();else if(e===this.today){if(r(e,"un"))return!1;var d=new Date;this._setRange({year:d.getFullYear(),month:d.getMonth(),day:d.getDate()})}else if(e===this.yesterday){if(r(e,"un"))return!1;d=new Date;var l=this._testDay(d.getFullYear(),d.getMonth(),d.getDate()-1);this._setRange({year:l.year,month:l.month,day:l.day})}else if(e===this.lastWeek){if(r(e,"un"))return!1;var u=(d=new Date).getDay()||7,v=d.getFullYear(),m=d.getMonth(),p=d.getDate()-u;p<0?(y={year:(l=this._testDay(v,m,p)).year,month:l.month,day:l.day-6},f={year:l.year,month:l.month,day:l.day}):(f={year:v,month:m,day:p},y={year:(l=this._testDay(d.getFullYear(),d.getMonth(),p-6)).year,month:l.month,day:l.day}),this._setRange(y,f)}else if(e===this.lastMonth){if(r(e,"un"))return!1;var y,f;d=new Date;y={year:(l=this._testDay(d.getFullYear(),d.getMonth(),0)).year,month:l.month,day:1},f={year:l.year,month:l.month,day:l.day},this._setRange(y,f)}else if(e===this.yearTouch){this.yearRange.innerText=this.min.year+"-"+this.max.year;v=this.cacheYear||this.currentYear,n="",h=this.min.year-4;var k=(o=this.max.year+4)-h;k<11?o+=11-k:1==(k=(k+1)%3)?o+=2:2==k&&(o+=1);for(c=h;c<=o;c++)n+="<button class='-d-p-s-year",c<this.min.year||c>this.max.year?n+=" un":c==v&&(n+=" in"),n+="' date-year='",n+=c,n+="'>",n+=c,n+="</button>";var b=(o-h+1)/3-4;k=(k=~~((v-h)/3)-1)>b?b:k,this.yearRangePosition=k,k*=25,this._setYearBtnBox(k),this.yearBtnBox.innerHTML=n,a(this.datePicker,"-year"),this.yearBtns=s(this.yearBtnBox,"-d-p-s-year")}else e===this.yearRange?this._back():e===this.yearPrev?this._prev():e===this.yearNext&&this._next();return!1},_unBtnClick:function(t,e){var i=this.currentMonth;switch(t){case"prev":this.prev();break;case"next":this.next()}if(i!=this.currentMonth){for(var a=e.innerText,n=s(s(this.yearBox,"-date-picker-month")[this.currentMonth],"-date-picker-date"),h=0;h<n.length;h++)if(n[h].innerText==a&&!r(n[h],"un")){e=n[h];break}e&&o(e,"click")}},__click:function(e){(e=e||t.event).preventDefault(),e.stopPropagation();var i;if(i=h(e.target,".-date-picker-date"))if(r(i,"prev"))this._unBtnClick("prev",i);else if(r(i,"next"))this._unBtnClick("next",i);else{if(r(i,"un"))return!1;var s=this.currentYear,d=this.currentMonth,l=~~i.innerText,u=this.input.datePickerData.bind,v=this.input.datePickerData.range;if(v){this.dateCache||(this.active={year:s,month:d,day:l,btn:i,index:c(i)-2},a(i,"active"));var m=this._mosaicStr(s,d,l);if(u&&"start"==v||"end"==v)if(this.dateCache){var p=this._sortDay(this.dateCache.str,m);this.callback&&this.callback(p),this.dateCache.start.value=p.min,this.dateCache.end.value=p.max,this.datePicker.style.display="none",this.dateCache=void 0}else{this.input.value=m,this.dateCache={str:m};for(var y,f=0;f<this.inputs.length;f++)if(this.inputs[f].datePickerData.bind==u&&this.inputs[f].datePickerData.range!=v){y=this.inputs[f];break}y?("start"==v?(this.dateCache.start=this.input,this.dateCache.end=y):(this.dateCache.end=this.input,this.dateCache.start=y),this.dateCache.on=v,o(y,"focus")):(this.datePicker.style.display="none",this.dateCache=void 0)}else if(this.dateCache){p=this._sortDay(this.dateCache.str,m);this.callback&&this.callback(p),m=p.min+("/"==this.join?" - ":" / ")+p.max,this.dateCache=void 0,this.input.value=m,this.datePicker.style.display="none"}else this.dateCache={str:m},this.input.value=m;this.dateCache||(n(this.active.btn,"active"),this.active=void 0,this.btnArr={})}else this.input.value=this._mosaicStr(s,d,l),this.datePicker.style.display="none"}else if(i=h(e.target,".-d-p-s-year")){if(r(i,"un"))return!1;var k=(s=~~i.innerText)-this.min.year+4;this._setYTP(k),this._back()}else if(i=h(e.target,".-d-p-s-month")){if(r(i,"un"))return!1;s=this.yearTouchPosition+this.min.year-4,d=~~i.getAttribute("date-month")-1;s!=this.currentYear&&(this._mosaicObj(s),this.currentYear=s),this.currentMonth=d,this.yearBox.setAttribute("data-month",d),this.ymBtn.innerHTML=this.currentYear+"年"+(this.currentMonth<9?"0"+(this.currentMonth+1):this.currentMonth+1)+"月",n(this.datePicker,"-show")}},_initEvent:function(){for(var e=0;e<this.inputs.length;e++)i(this.inputs[e],"focus",this._inputFocus.bind(this,this.inputs[e]));i(this.datePicker,"touchmove",this._disableEvent),i(this.yearBox,"click",this.__click.bind(this)),i(this.yearBtnBox,"click",this.__click.bind(this)),i(this.monthBtnBox,"click",this.__click.bind(this)),i(this.yearMonth,"click",this._click.bind(this,this.yearMonth)),i(this.prevEl,"click",this._click.bind(this,this.prevEl)),i(this.nextEl,"click",this._click.bind(this,this.nextEl)),i(this.today,"click",this._click.bind(this,this.today)),i(this.yesterday,"click",this._click.bind(this,this.yesterday)),i(this.lastWeek,"click",this._click.bind(this,this.lastWeek)),i(this.lastMonth,"click",this._click.bind(this,this.lastMonth)),i(this.yearTouch,"click",this._click.bind(this,this.yearTouch)),i(this.yearRange,"click",this._click.bind(this,this.yearRange)),i(this.yearPrev,"click",this._click.bind(this,this.yearPrev)),i(this.yearNext,"click",this._click.bind(this,this.yearNext)),i(document,"touchstart",this._defaultTouch.bind(this)),i(document,"mousedown",this._defaultTouch.bind(this)),i(t,"resize",this._reSize.bind(this)),i(this.box,"touchstart",this._TouchS.bind(this,this.box)),i(this.box,"touchmove",this._TouchM.bind(this,this.box)),i(this.box,"touchend",this._TouchE.bind(this,this.box)),i(this.box,"touchcancel",this._TouchE.bind(this,this.box)),i(this.yearTouch,"touchstart",this._TouchS.bind(this,this.yearTouch)),i(this.yearTouch,"touchmove",this._TouchM.bind(this,this.yearTouch)),i(this.yearTouch,"touchend",this._TouchE.bind(this,this.yearTouch)),i(this.yearTouch,"touchcancel",this._TouchE.bind(this,this.yearTouch)),i(this.yearBtnBox,"touchstart",this._TouchS.bind(this,this.yearBtnBox)),i(this.yearBtnBox,"touchmove",this._TouchM.bind(this,this.yearBtnBox)),i(this.yearBtnBox,"touchend",this._TouchE.bind(this,this.yearBtnBox)),i(this.yearBtnBox,"touchcancel",this._TouchE.bind(this,this.yearBtnBox)),/.*Firefox.*/.test(navigator.userAgent)?(i(this.box,"DOMMouseScroll",this._mouseWheel.bind(this,this.box)),i(this.yearTouch,"DOMMouseScroll",this._mouseWheel.bind(this,this.yearTouch)),i(this.yearBtnBox,"DOMMouseScroll",this._mouseWheel.bind(this,this.yearBtnBox))):(i(this.box,"mousewheel",this._mouseWheel.bind(this,this.box)),i(this.yearTouch,"mousewheel",this._mouseWheel.bind(this,this.yearTouch)),i(this.yearBtnBox,"mousewheel",this._mouseWheel.bind(this,this.yearBtnBox))),i(this.box,"mouseover",this._mouseO.bind(this))},_setFormat:function(t){if("string"!=typeof t)return this.format="YYYY-MM-DD";null==t.match(/\d/)&&null!=t.match(/YYYY(?!Y)/)&&null!=t.match(/MM(?!M)/)&&null!=t.match(/DD(?!D)/)?(this.format=t,null!=t.match(/hh(?!h)/)&&(this.hasDate=!0)):this.format="YYYY-MM-DD"},_sortDay:function(t,e){var i,s;return new Date(t.replace(this.join,"/").replace(this.join,"/"))>new Date(e.replace(this.join,"/").replace(this.join,"/"))?(i=t,s=e):(s=t,i=e),{max:i,min:s}},_testDay:function(t,e,i){return i<1&&(--e<0&&(e=11,t--),i+=0==e||2==e||4==e||6==e||7==e||9==e||11==e?31:3==e||5==e||8==e||10==e?30:t%4==0?29:28),{year:t,month:e,day:i}},_mosaicObj:function(t){var e="<div class='-prev-year'>上一年</div>";if(this.day[t])for(i=0;i<12;i++)e+=this.day[t][i];else{this.day[t]=[];for(var i=1;i<=12;i++){var n=this._mosaicMonth(t,i);this.day[t][i-1]=n,e+=n}}e+="<div class='-next-year'>下一年</div>",this.yearBox.innerHTML=e;var h,o=s(this.yearBox,"-date-picker-month");if(this.active&&t==this.active.year&&(h=s(o[this.active.month],"-date-picker-date"),this.active.btn=h[this.active.index],a(this.active.btn,"active")),this.min||this.max){if(this.min.year==t){h=s(o[this.min.month],"-date-picker-date");for(i=0;i<h.length;i++)if(!r(h[i],"un")){if(!(~~h[i].innerText<this.min.day))break;a(h[i],"un")}}if(this.max.year==t)for(i=(h=s(o[this.max.month],"-date-picker-date")).length-1;i>-1;i--)if(!r(h[i],"un")){if(!(~~h[i].innerText>this.max.day))break;a(h[i],"un")}}},_mosaicMonth:function(t,e){var i,s,a=t%4==0,n="<div class='-date-picker-month'><div class='-before'>"+e+"</div><div class='-after'>"+e+"</div>",r=new Date(t+"/"+e+"/1").getDay()||7;return 1==e?i=s=31:2==e?(i=a?29:28,s=31):3==e?(i=31,s=a?29:28):4==e||4==e||9==e||11==e?(i=30,s=31):5==e||7==e||10==e||12==e?(i=31,s=30):(i=31,s=31),n+=this._mosaicDate(t,e,r,s-r),n+=this._mosaicDate(t,e,i),r+=i,n+=this._mosaicDate(t,e,42-r),n+="</div>"},_mosaicDate:function(t,e,i,s){var a=new Date,n=a.getFullYear(),r=a.getMonth()+1,h=a.getDate()-1,o="";s=s||0;for(var c=0;c<i;c++)o+="<button class='-date-picker-date",s>0||i<28?(o+=" un",o+=s>0?" prev":" next",o+="'>",c+s<9&&(o+="&ensp;"),o+=c+s+1):(c==h&&e==r&&t==n&&(o+=" in"),o+="'>",c<9&&(o+="&ensp;"),o+=c+1),o+="</button>";return o},_mosaicStr:function(t,e,i,s,a,n){var r;return r=t+this.join+(e<9?"0"+(e+1):e+1)+this.join+(i<10?"0"+i:i),void 0!=s&&(r+=" ",r+=s,r+=":",r+=a?a<10?"0"+a:a:"00",r+=":",r+=n?n<10?"0"+n:n:"00"),r},_resetStr:function(t){for(var e=this.format.replace(/YYYY(?!Y)/,0).replace(/MM(?!M)/,1).replace(/DD(?!D)/,2).replace(/hh(?!h)/,3).replace(/mm(?!m)/,4).replace(/ss(?!s)/,5).replace(/\D/g," ").split(" "),i=t.replace(/\D/g," ").split(" "),s=[],a=0;a<i.length;a++)e[a]&&(s[e[a]]=i[a]);t=s[0]+"/"+s[1]+"/"+s[2];return s[3]&&(t+=" ",t+=s[3],s[4]||(s[4]="00"),t+=":",t+=s[4],s[5]||(s[5]="00"),t+=":",t+=s[5]),{obj:s,str:t}},_reSize:function(){this.wW=t.innerWidth,this.wH=t.innerHeight,this.datePicker.style.visibility="hidden",this.datePicker.style.display="block",this.datePickerW=this.datePicker.offsetWidth,this.datePickerH=this.datePicker.offsetHeight,this.datePicker.style.display="none",this.datePicker.style.visibility="visible"}},t.DatePicker=d);function i(t,e,i,s){s?t.removeEventListener?t.removeEventListener(e,i):t.detachEvent?(t.detachEvent("on"+e,t[e+i]),t[e+i]=null,t["e"+e+i]=null):t["on"+e]=null:t.addEventListener?t.addEventListener(e,i):t.attachEvent?(t["e"+e+i]=i,t[e+i]=function(){t["e"+e+i](window.event)},t.attachEvent("on"+e,t[e+i])):t["on"+e]=i}function s(t,e){if(t.getElementsByClassName)return t.getElementsByClassName(e);for(var i=[],s=t.getElementsByTagName("*"),a=0;a<s.length;a++)for(var n=s[a].className.split(" "),r=0;r<n.length;r++)if(n[r]===e){i.push(s[a]);break}return i}function a(t,e){if(!t.className)return t.className=e;for(var i=t.className.split(" "),s=!1,a=0;a<i.length;a++)i[a]===e&&(s=!0);s||(t.className+=" "+e)}function n(t,e){if(!t.className||t.className==e)return t.className="";for(var i=t.className.split(" "),s=0;s<i.length;s++)i[s]===e&&(i.splice(s,1),t.className=i.join(" "))}function r(t,e){if(!t.className)return!1;for(var i=!1,s=t.className.split(" "),a=0;a<s.length;a++)s[a]===e&&(i=!0);return i}function h(t,e){if(e instanceof HTMLElement)for(;t&&t!=e;)t=t.parentElement;else{var i=e.split("");if("."==i[0])for(e=e.replace(".","");t;){if(t.className){i=t.className.split(" ");for(var s=!1,a=0;a<i.length;a++)if(i[a]==e){s=!0;break}if(s)break}t=t.parentElement}else if("#"==i[0])for(e=e.replace("#","");t&&t.id!=e;)t=t.parentElement;else for(;t&&t.nodeName.toLowerCase()!=e;)t=t.parentElement}return t}function o(t,e){if(document.createEventObject){var i=document.createEventObject();return t.fireEvent("on"+e,i)}return(i=document.createEvent("HTMLEvents")).initEvent(e,!0,!0),!t.dispatchEvent(i)}function c(t){for(var e=t.parentNode.children,i=0;i<e.length;i++)if(e[i]===t)return i}function d(e){return this.join="-",this.wW=t.innerWidth,this.wH=t.innerHeight,this.touchState={},this.inputs=Array.prototype.slice.call(s(document,"datepicker"),0),this.maxID=(new Date).getTime(),this.scrollEl=t,this.btnArr={},this._init(e),this.api}}(window);