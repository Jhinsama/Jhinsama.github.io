!function(t,e){function i(t,e,i,s){s?t.removeEventListener?t.removeEventListener(e,i):t.detachEvent?(t.detachEvent("on"+e,t[e+i]),t[e+i]=null,t["e"+e+i]=null):t["on"+e]=null:t.addEventListener?t.addEventListener(e,i):t.attachEvent?(t["e"+e+i]=i,t[e+i]=function(){t["e"+e+i](window.event)},t.attachEvent("on"+e,t[e+i])):t["on"+e]=i}function s(t,e){if(t.getElementsByClassName)return t.getElementsByClassName(e);for(var i=[],s=t.getElementsByTagName("*"),n=0;n<s.length;n++)for(var a=s[n].className.split(" "),r=0;r<a.length;r++)if(a[r]===e){i.push(s[n]);break}return i}function n(t,e){if(!t.className)return t.className=e;for(var i=t.className.split(" "),s=!1,n=0;n<i.length;n++)i[n]===e&&(s=!0);s||(t.className+=" "+e)}function a(t,e){if(!t.className||t.className==e)return t.className="";for(var i=t.className.split(" "),s=0;s<i.length;s++)i[s]===e&&(i.splice(s,1),t.className=i.join(" "))}function r(t,e){if(!t.className)return!1;for(var i=!1,s=t.className.split(" "),n=0;n<s.length;n++)s[n]===e&&(i=!0);return i}function h(t,e){for(var i=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector;t&&!i.call(t,e);)t=t.parentElement;return t}function o(){this.join="-",this.wW=t.innerWidth,this.wH=t.innerHeight,this.touchState={},this.inputs=Array.prototype.slice.call(s(document,"datepicker"),0),this._init()}t.datePicker||(o.prototype={set:function(t,e){if(t instanceof HTMLElement)if("input"==t.nodeName.toLowerCase()){for(var s=!1,n=0;n<this.inputs.length;n++)this.inputs[n]===t&&(s=!0);s||(i(t,"focus",this._inputFocus.bind(this,t)),this.inputs.push(t),t.type="text",t.datePickerData=e instanceof Object?e:{})}else console.dir(t);else try{for(n=0;n<t.length;n++){var a=t[n];if(a instanceof HTMLElement)if("input"==a.nodeName.toLowerCase()){for(var s=!1,r=0;r<this.inputs.length;r++)this.inputs[r]===a&&(s=!0);s||(i(a,"focus",this._inputFocus.bind(this,a)),this.inputs.push(a),a.type="text",a.datePickerData=e instanceof Object?e:{})}else console.dir(a);else console.dir(a)}}catch(t){console.log("传入的元素或许不是输入框")}},prev:function(){return this.currentMonth--,this.currentMonth<0?(this.yearBox.style.cssText="",this.yearBox.innerHTML="",this.currentMonth=11,this.yearBox.setAttribute("data-month",11),this.currentYear--,this._mosaicObj(this.currentYear)):(this.yearBox.style.cssText="-webkit-transition:300ms;-moz-transition:300ms;-ms-transition:300ms;-o-transition:300ms;transition:300ms;",this.yearBox.setAttribute("data-month",this.currentMonth)),this.ymBtn.innerHTML=this.currentYear+"年"+(this.currentMonth<9?"0"+(this.currentMonth+1):this.currentMonth+1)+"月",!0},next:function(){return this.currentMonth++,this.currentMonth>11?(this.yearBox.style.cssText="",this.yearBox.innerHTML="",this.currentMonth=0,this.yearBox.setAttribute("data-month",0),this.currentYear++,this._mosaicObj(this.currentYear)):(this.yearBox.style.cssText="-webkit-transition:300ms;-moz-transition:300ms;-ms-transition:300ms;-o-transition:300ms;transition:300ms;",this.yearBox.setAttribute("data-month",this.currentMonth)),this.ymBtn.innerHTML=this.currentYear+"年"+(this.currentMonth<9?"0"+(this.currentMonth+1):this.currentMonth+1)+"月",!0},_init:function(){this._initInputs();var t=new Date;this.currentYear=t.getFullYear(),this.currentMonth=t.getMonth(),this.day={},this._create()&&(this._getElement()._mosaicObj(this.currentYear),this._initEvent())},_reSize:function(){this.wW=t.innerWidth,this.wH=t.innerHeight,this.datePickerW=this.datePicker.offsetWidth,this.datePickerH=this.datePicker.offsetHeight},_create:function(){var t=document.createElement("style");return t.type="text/css",t.innerHTML="",document.getElementsByTagName("head")[0].appendChild(t),this.datePicker=document.createElement("div"),this.datePicker.className="-date-picker",this.datePicker.innerHTML="<div class='-date-picker-point'><div class='-rotate45'></div></div><div class='-date-picker-main'><div class='-date-picker-foot'><div><div class='-date-picker-ym -d-p-middle'><button id='-date-picker-ym'></button><span class='-dpcymt -rotate45'></span></div></div></div><div class='-date-picker-day'><div><div class='-date-picker-title'><span class='-d-p-middle'>日</span><span class='-d-p-middle'>一</span><span class='-d-p-middle'>二</span><span class='-d-p-middle'>三</span><span class='-d-p-middle'>四</span><span class='-d-p-middle'>五</span><span class='-d-p-middle'>六</span></div><div class='-date-picker-prev'><div class='-rotate45'></div></div><div class='-date-picker-box'><div id='-date-picker-year'></div></div><div class='-date-picker-next'><div class='-rotate45'></div></div></div></div><div class='-date-picker-btn'><div><div><button class='-date-picker-btn-tday'>今&emsp;天</button></div><div><button class='-date-picker-btn-ystday'>昨&emsp;天</button></div><div><button class='-date-picker-btn-lsweek'>上一周</button></div><div><button class='-date-picker-btn-lsmonth'>上一月</button></div></div></div></div>",document.body.appendChild(this.datePicker),this.datePickerW=this.datePicker.offsetWidth,this.datePickerH=this.datePicker.offsetHeight,this.datePicker.style.display="none",!0},_getElement:function(){return this.point=s(this.datePicker,"-date-picker-point")[0],this.yearMonth=s(this.datePicker,"-date-picker-ym")[0],this.ymBtn=document.getElementById("-date-picker-ym"),this.ymBtn.innerHTML=this.currentYear+"年"+(this.currentMonth<9?"0"+(this.currentMonth+1):this.currentMonth+1)+"月",this.box=s(this.datePicker,"-date-picker-box")[0],this.yearBox=document.getElementById("-date-picker-year"),this.yearBox.setAttribute("data-month",this.currentMonth),this.yearBox.style.cssText="-webkit-transition:300ms;-moz-transition:300ms;-ms-transition:300ms;-o-transition:300ms;transition:300ms;",this.prevEl=s(this.datePicker,"-date-picker-prev")[0],this.nextEl=s(this.datePicker,"-date-picker-next")[0],this.today=s(this.datePicker,"-date-picker-btn-tday")[0],this.yesterday=s(this.datePicker,"-date-picker-btn-ystday")[0],this.lastWeek=s(this.datePicker,"-date-picker-btn-lsweek")[0],this.lastMonth=s(this.datePicker,"-date-picker-btn-lsmonth")[0],this},_initPicker:function(){var t=new Date,e=t.getFullYear(),i=t.getMonth(),s=!1;e!=this.currentYear&&(this.currentYear=e,this._mosaicObj(e),s=!0),i!=this.currentMonth&&(this.currentMonth=i,this.yearBox.setAttribute("data-month",i),s=!0),s&&(this.ymBtn.innerHTML=this.currentYear+"年"+(this.currentMonth<9?"0"+(this.currentMonth+1):this.currentMonth+1)+"月")},_inputFocus:function(e){e.blur(),this.input=e;var i=e.offsetTop,s=e.offsetHeight,r=e.offsetLeft;e.offsetWidth;return this.datePicker.style.top=i+s+"px",r+this.datePickerW>this.wW?(this.datePicker.style.left=this.wW-this.datePickerW+"px",this.point.style.left=r-this.wW+this.datePickerW+15+"px"):(this.datePicker.style.left=r+"px",this.point.style.left="10%"),e.datePickerData.range?(a(this.lastWeek,"un"),a(this.lastMonth,"un")):(n(this.lastWeek,"un"),n(this.lastMonth,"un")),this._initPicker(),this.datePicker.style.display="block",t.scrollTo(0,i-5),!1},_disableEvent:function(e){return(e=e||t.event).preventDefault(),e.stopPropagation(),!1},_defaultTouch:function(e){var i=h((e=e||t.event).target,".-date-picker"),s=h(e.target,"input"),n=!0;if(s)for(var a=0;a<this.inputs.length;a++)this.inputs[a]===s&&(n=!1);!i&&n&&(this.datePicker.style.display="none")},_touchStart:function(e){var i=i||t.event;this.touchState.startX=this.touchState.moveX=i.touches[0].clientX,this.touchState.startY=this.touchState.moveY=i.touches[0].clientY,e===this.box&&(this.boxH=this.box.offsetHeight)},_touchMove:function(e){var i=i||t.event,s=i.touches[0].clientY;if(this.touchState.moveY=s,e===this.box){var n=this.currentMonth*this.boxH+this.touchState.startY-s;this.yearBox.style.cssText="-webkit-transform: translateY("+-n+"px) translateZ(0);-moz-transform: translateY("+-n+"px) translateZ(0);-ms-transform: translateY("+-n+"px) translateZ(0);-o-transform: translateY("+-n+"px) translateZ(0);transform: translateY("+-n+"px) translateZ(0);"}},_touchEnd:function(t){if(t===this.box){var e=this.touchState.moveY-this.touchState.startY,i=Math.abs(e)>=this.boxH/4;e>0?i?this.prev():this.yearBox.style.cssText="-webkit-transition:300ms;-moz-transition:300ms;-ms-transition:300ms;-o-transition:300ms;transition:300ms;":e<0&&(i?this.next():this.yearBox.style.cssText="-webkit-transition:300ms;-moz-transition:300ms;-ms-transition:300ms;-o-transition:300ms;transition:300ms;")}},_click:function(e){var i=i||t.event;if(i.preventDefault(),i.stopPropagation(),e instanceof HTMLElement){if(e===this.yearMonth);else if(e===this.prevEl)this.prev();else if(e===this.nextEl)this.next();else if(e===this.today){var s=(o=new Date).getFullYear(),n=o.getMonth(),a=o.getDate();this.input.value=s+this.join+(n<9?"0"+(n+1):n+1)+this.join+(a<10?"0"+a:a),this.range,this.datePicker.style.display="none"}else if(e===this.yesterday){var o=new Date,s=o.getFullYear(),n=o.getMonth();(a=o.getDate()-1)<1&&(--n<0&&s--,a=0==n||2==n||4==n||6==n||7==n||9==n||11==n?31:3==n||5==n||8==n||10==n?30:s%4==0?29:28),this.input.value=s+this.join+(n<9?"0"+(n+1):n+1)+this.join+(a<10?"0"+a:a),this.range,this.datePicker.style.display="none"}else if(e===this.lastWeek){if(r(e,"un"))return!1;console.log("上一周"),this.datePicker.style.display="none"}else if(e===this.lastMonth){if(r(e,"un"))return!1;console.log("上一月"),this.datePicker.style.display="none"}}else if(h(i.target,".-date-picker-date")){var c=h(i.target,".-date-picker-date");if(r(c,"prev"))this.prev();else if(r(c,"next"))this.next();else{var s=this.currentYear,n=this.currentMonth+1,a=~~c.innerText;this.range||(this.input.value=s+this.join+(n<9?"0"+n:n)+this.join+(a<10?"0"+a:a),this.datePicker.style.display="none")}}return!1},_mouseWheel:function(){if(this.scroll)return!1;this.scroll=!0;var e=e||t.event;e.preventDefault(),e.stopPropagation();var i=e.detail,s=e.wheelDelta;return i?i>0?this.next():this.prev():s>0?this.prev():this.next(),delete this.scroll,!1},_initInputs:function(){for(var t=0;t<this.inputs.length;t++)this.inputs[t].datePickerData={}},_initEvent:function(){for(var e=0;e<this.inputs.length;e++)i(this.inputs[e],"focus",this._inputFocus.bind(this,this.inputs[e]));i(this.datePicker,"touchmove",this._disableEvent),i(this.datePicker,"click",this._click.bind(this)),i(this.prevEl,"click",this._click.bind(this,this.prevEl)),i(this.nextEl,"click",this._click.bind(this,this.nextEl)),i(this.today,"click",this._click.bind(this,this.today)),i(this.yesterday,"click",this._click.bind(this,this.yesterday)),i(this.lastWeek,"click",this._click.bind(this,this.lastWeek)),i(this.lastMonth,"click",this._click.bind(this,this.lastMonth)),i(document,"touchstart",this._defaultTouch.bind(this)),i(document,"mousedown",this._defaultTouch.bind(this)),i(t,"resize",this._reSize.bind(this)),i(this.box,"touchstart",this._touchStart.bind(this,this.box)),i(this.box,"touchmove",this._touchMove.bind(this,this.box)),i(this.box,"touchend",this._touchEnd.bind(this,this.box)),i(this.box,"touchcancel",this._touchEnd.bind(this,this.box)),/.*Firefox.*/.test(navigator.userAgent)?i(this.box,"DOMMouseScroll",this._mouseWheel.bind(this)):i(this.box,"mousewheel",this._mouseWheel.bind(this))},_mosaicObj:function(t){var e="<div class='-prev-year'>上一年</div>";if(this.day[t])for(i=0;i<12;i++)e+=this.day[t][i];else{this.day[t]=[];for(var i=1;i<=12;i++){var s=this._mosaicMonth(t,i);this.day[t][i-1]=s,e+=s}}e+="<div class='-next-year'>下一年</div>",this.yearBox.innerHTML=e},_mosaicMonth:function(t,e){var i=!1;t%4==0&&(i=!0);var s=0,n="<div class='-date-picker-month'><div class='-before'>"+e+"</div><div class='-after'>"+e+"</div>",a=new Date(t+"/"+e+"/1").getDay();a=0==a?7:a,n+=1==e||2==e||4==e||6==e||9==e||11==e?this._mosaicDate(t,e,a,31-a):5==e||7==e||8==e||10==e||12==e?this._mosaicDate(t,e,a,30-a):i?this._mosaicDate(t,e,a,29-a):this._mosaicDate(t,e,a,28-a),s+=a,1==e||3==e||5==e||7==e||8==e||10==e||12==e?(n+=this._mosaicDate(t,e,31),s+=31):4==e||6==e||9==e||11==e?(n+=this._mosaicDate(t,e,30),s+=30):i?(n+=this._mosaicDate(t,e,29),s+=29):(n+=this._mosaicDate(t,e,28),s+=28);var r=42-s;return n+=this._mosaicDate(t,e,r),n+="</div>"},_mosaicDate:function(t,e,i,s){var n=new Date,a=n.getFullYear(),r=n.getMonth()+1,h=n.getDate()-1,o="";s=s||0;for(var c=0;c<i;c++)s>0||i<28?(o+=s>0?"<button class='-date-picker-date un prev'>":"<button class='-date-picker-date un next'>",c+s<9&&(o+="&ensp;"),o+=c+s+1,o+="</button>"):(o+=c==h&&e==r&&t==a?"<button class='-date-picker-date in'>":"<button class='-date-picker-date'>",c<9&&(o+="&ensp;"),o+=c+1,o+="</button>");return o}},t.datePicker=o)}(window);