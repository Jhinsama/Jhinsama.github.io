var categories=[{type:0,name:"全部"},{type:1,name:"水/饮料"},{type:2,name:"休闲食品",def:!0}],commoditys=[[{value:0,name:"茶叶蛋",img:"",price:4.5,oPrice:5,tag:["今日特价","热销"]},{value:1,name:"农夫山泉",img:"",price:1.5},{value:2,name:"辣条",img:"",price:2,tag:["热销"]}],[{value:1,name:"农夫山泉",img:"",price:1.5}],[{value:0,name:"茶叶蛋",img:"",price:4.5,oPrice:5,tag:["今日特价","热销"]},{value:2,name:"辣条",img:"",price:2,tag:["热销"]}]];!function(e,t){function n(e){S.removeClass("animate");var t=document.createElement("div");t.className="circle",t.innerHTML="<div></div>",document.body.appendChild(t),new function(e){var t,n,i,a,o,s,r,c,d=0,m=null;this.config=e||{},this.origin=$(this.config.origin)||null,this.target=$(this.config.target)||null,this.element=$(this.config.element)||null,this.a=this.config.a||.004,this.time=this.config.time||1e3,this.init=function(){var e=this.origin.offset(),m=this.target.offset(),l=this.element.offset();return t=e.left+e.width/2-l.width/2,n=e.top+e.height/2-l.height/2,i=m.left+m.width/2-l.width/2,a=m.top+m.height/2-l.height/2,o=t,s=n,r=i-t,c=a-n,speedx=r/this.time,d=(c-this.a*r*r)/r,this.element.css({left:t,top:n}),this},this.moveStyle=function(){var e="position",t=document.createElement("div");return"placeholder"in t&&["","ms","moz","webkit"].forEach(function(n){var i=n+(n?"T":"t")+"ransform";i in t.style&&(e=i)}),e},this.move=function(){var e=(new Date).getTime(),t=this.moveStyle(),n=this;return m=setInterval(function(){if((new Date).getTime()-e>n.time)return clearInterval(m),n.element.css({left:i,top:a}),void("function"==typeof n.config.callback&&n.config.callback(n.element));x=speedx*((new Date).getTime()-e),y=n.a*x*x+d*x,"position"===t?n.element.css({left:x+o,top:y+s}):window.requestAnimationFrame?window.requestAnimationFrame(n.element[0].style[t]="translate("+x+"px,"+y+"px)"):n.element[0].style[t]="translate("+x+"px,"+y+"px)"},15),this},this.init()}({origin:e,element:t,target:"#target",a:.007,time:500,callback:function(e){e.remove(),S.addClass("animate")}}).move()}function i(){"0"==k.text()?function(e,t){g.text(e),O.showToast?clearTimeout(O.showToast):p.addClass("show-toast");O.showToast=setTimeout(o,t||1500)}("请选择商品"):(F.scrollTo(0,0),p.addClass("show-cart"),N.text("立即支付").data("state",1),O.showCart=!0)}function a(){O.showCart&&(p.removeClass("show-cart"),N.text("结 算").data("state",0),O.showCart=!1)}function o(){O.showToast&&(clearTimeout(O.showToast),p.removeClass("show-toast"),O.showToast=void 0)}function s(t){if(O.currentType!=t&&(null!=O.currentType&&f[O.currentType].nav.removeClass("on"),f[t].nav.addClass("on"),O.currentType=t,!O.loading))if(O.loading=!0,O.loadType=t,C.html(""),O.loading=!1,O.loadType!=O.currentType)s(O.currentType);else{for(var n=commoditys[t],i=0;i<n.length;i++){var a=f.ware[n[i].value];a=a?f.ware[n[i].value].dom:r(n[i]),C.append(a)}E.refresh(),e.sessionStorage.setItem("currentType",O.currentType)}}function r(e){var t=$("<div>"),n="";return t[0].className="commodity",n+="<div class='commodity-img' data-ware='",n+=e.value,n+="'><div><img src='",n+=e.img?e.img:"",n+="'></div></div><div class='commodity-main'><div><div class='commodity-name txt-over'>",n+=e.name,n+="</div><div class='commodity-tag'>",n+="",n+="</div><div class='commodity-price'><div class='now'>￥",n+=e.price.toFixed(1),n+="</div>",e.oPrice&&(n+="<div class='old'>￥",n+=e.oPrice.toFixed(1),n+="</div>"),n+="</div>",n+="<div class='control-num' data-ware='",n+=e.value,n+="'><div class='mask'></div><div class='pre'></div><div class='num'>0</div><div class='add'></div></div></div></div>",t.html(n),f.ware[e.value]={dom:t,obj:e},t}function c(e){var t=$("<div>"),n="";return t[0].className="cart-commodity",n+="<div class='txt-over'>",n+=e.name,n+="</div><div class='control-num on' data-ware='",n+=e.value,n+="'><div class='mask'></div><div class='pre'></div><div class='num'>0</div><div class='add'></div></div>",t.html(n),t}function d(t,n){P[t]||(P[t]={dom:c(f.ware[t].obj),obj:f.ware[t].obj,num:0},D.append(P[t].dom),F.refresh()),P[t].num=n||P[t].num+1,P[t].dom.find(".num").text(P[t].num),l(),e.sessionStorage.setItem("cartData",JSON.stringify(P))}function m(t,n){P[t].num=n||P[t].num-1,0==P[t].num?(P[t].dom.remove(),F.refresh(),delete P[t]):P[t].dom.find(".num").text(P[t].num),l(),0==u().length&&a(),e.sessionStorage.setItem("cartData",JSON.stringify(P))}function l(){var e=0,t=0;for(var n in P)e+=P[n].num,t+=P[n].num*P[n].obj.price;!function(e){0==e.num?I.hide():I.show().text(e.num);k.text(e.num),M.text(e.total.toFixed(1))}({num:e,total:t})}function u(){var e=[];for(var t in P)e.push({val:t,num:P[t].num});return e}$(document).ready(function(){var t=e.sessionStorage.getItem("cartData");if(t){f={ware:{}},P=JSON.parse(t);for(var n in P)P[n].dom=c(P[n].obj),P[n].dom.find(".num").text(P[n].num),D.append(P[n].dom),r(P[n].obj).find(".control-num").addClass("on").find(".num").text(P[n].num);F.refresh(),l()}t=e.sessionStorage.getItem("currentType"),function(e,t){f||(f={});for(var n=T.children(),i=e[0].type,a=0;a<e.length;a++){null!=t?e[a].type==t&&(i=t):e[a].def&&(i=e[a].type);var o=$("<div>");o[0].className="txt-over nav",o.data("type",e[a].type),o.text(e[a].name),n.append(o),f[e[a].type]={},f[e[a].type].nav=o}A.refresh(),f.ware||(f.ware={}),(v=n.children()).bind("tap",function(){s($(this).data("type"))}),s(i)}(categories,t),wx.ready(function(){var e=function(){},t=function(){};wx.onMenuShareTimeline({title:"",link:"",imgUrl:"",success:e,cancel:t}),wx.onMenuShareAppMessage({title:"",desc:"",link:"",imgUrl:"",success:e,cancel:t}),w.click(function(){wx.scanQRCode({desc:"scanQRCode desc",needResult:0,scanType:["qrCode","barCode"],success:function(e){alert(JSON.stringify(e))},error:function(e){e.errMsg.indexOf("function_not_exist")>0&&alert("版本过低请升级")}})})}),wx.error(function(e){console.log(e)}),wx.config({debug:!1,appId:"wx1b38c412b11dd4fb",timestamp:"1512372319",nonceStr:"VO6PD9Tlxsa1g3KB",signature:"24f2e6ea09ee21606359b5ab451711286b575f78",jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","scanQRCode"]})}),document.addEventListener("touchmove",function(e){e.preventDefault()},!!function(){var e=!1;try{addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){e=!0}}))}catch(e){}return e}()&&{capture:!1,passive:!1});$(document);var v,f,p=$(document.body),h=$("#mask"),g=$("#toast"),w=$(".scan-qr"),T=$(".categories"),b=(T.children(),$(".commodity-list")),C=b.children(),S=$(".icon-cart"),k=$(".cart-iner-num"),I=$(".cart-badge"),j=$(".cart-commodity_box"),D=j.children(),M=$(".total-price"),N=$(".btn-confirm"),O={loading:!1,showCart:!1,showToast:!1,currentType:null,loadType:null},P={},A=new IScroll(T[0],{tap:!0}),E=new IScroll(b[0],{tap:!0}),F=new IScroll(j[0],{tap:!0});N.click(function(){if("1"==$(this).data("state"))u();else i()}),S.click(function(){O.showCart?a():i()}),h.click(function(){O.showCart&&a(),o()}),C.on("tap",".add",function(){var e=$(this),t=e.parent(),i=e.siblings(".num"),a=~~i.text();a++,i.text(a),t.addClass("on"),d(t.data("ware"),a),n(this)}),C.on("tap",".pre",function(){var e=$(this),t=e.parent(),n=e.siblings(".num"),i=~~n.text();i=--i<0?0:i,n.text(i),i<1&&t.removeClass("on"),m(t.data("ware"),i)}),D.on("tap",".add",function(){var e=$(this),t=e.parent(),n=e.siblings(".num"),i=t.data("ware"),a=~~n.text();a++,f.ware[i].dom.find(".num").text(a),d(i,a)}),D.on("tap",".pre",function(){var e=$(this),t=e.parent(),n=e.siblings(".num"),i=t.data("ware"),a=~~n.text();a=--a<0?0:a,f.ware[i].dom.find(".num").text(a),a<1&&f.ware[i].dom.find(".control-num").removeClass("on"),m(i,a)})}(window);